exports.id=169,exports.ids=[169],exports.modules={9363:(e,a,t)=>{let r={"1aad7720052bcbb3c3fff8073038f2a189fc9f98":()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.deleteClass),"4c018bc9b36e8e4ee0c64573afa34673fa514a06":()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.createClass),"7914dc5fbc064000e9e7e67beeae2d6d76de8861":()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.setClassLead),b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d:()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.listClasses),"51a097bff94b6d7bde5cfb7a76cc419ca2d2d897":()=>Promise.resolve().then(t.bind(t,1379)).then(e=>e.createRoom),"88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0":()=>Promise.resolve().then(t.bind(t,1379)).then(e=>e.deleteRoom),"8a57dfb094cf75dda1cd39da095655f2cc8d362e":()=>Promise.resolve().then(t.bind(t,1379)).then(e=>e.listRooms)};async function n(e,...a){return(await r[e]()).apply(null,a)}e.exports={"1aad7720052bcbb3c3fff8073038f2a189fc9f98":n.bind(null,"1aad7720052bcbb3c3fff8073038f2a189fc9f98"),"4c018bc9b36e8e4ee0c64573afa34673fa514a06":n.bind(null,"4c018bc9b36e8e4ee0c64573afa34673fa514a06"),"7914dc5fbc064000e9e7e67beeae2d6d76de8861":n.bind(null,"7914dc5fbc064000e9e7e67beeae2d6d76de8861"),b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d:n.bind(null,"b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d"),"51a097bff94b6d7bde5cfb7a76cc419ca2d2d897":n.bind(null,"51a097bff94b6d7bde5cfb7a76cc419ca2d2d897"),"88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0":n.bind(null,"88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0"),"8a57dfb094cf75dda1cd39da095655f2cc8d362e":n.bind(null,"8a57dfb094cf75dda1cd39da095655f2cc8d362e")}},9371:(e,a,t)=>{Promise.resolve().then(t.bind(t,342))},342:(e,a,t)=>{"use strict";t.d(a,{Editor:()=>c});var r=t(326),n=t(7577),s=t(2816),l=t(3679);function d(e="id"){return`${e}_${Math.random().toString(36).slice(2,9)}`}function i(e,a){let t={left:e.x,top:e.y,right:e.x+e.w,bottom:e.y+e.h},r={left:a.x,top:a.y,right:a.x+a.w,bottom:a.y+a.h};return!(t.right<r.left||t.left>r.right||t.bottom<r.top||t.top>r.bottom)}function c({classes:e,rooms:a}){let[c,o]=(0,n.useState)(null),[f,u]=(0,n.useState)(""),[h,m]=(0,n.useState)(""),[b,p]=(0,n.useState)(null),[x,g]=(0,n.useState)(null),[j,v]=(0,n.useState)("owner"),[w,y]=(0,n.useState)([]),[N,S]=(0,n.useState)([]),[z,I]=(0,n.useState)(null),[P,E]=(0,n.useState)("idle"),[C,R]=(0,n.useState)(!1),D=(0,n.useRef)(new Map),k=(0,n.useRef)(null),T=(0,n.useCallback)(async e=>{if(!c?.id||!f||!h)return;let a=await fetch(`/api/plan?ownerProfileId=${c.id}&classId=${f}&roomId=${h}&create=${e?"1":"0"}&includeLead=1`);if(!a.ok)return;let t=await a.json();p(t.plan),g(t.leadPlan),y(t.plan.elements.map(e=>({...e}))),I(null)},[c?.id,f,h]),_=(0,n.useCallback)(()=>{b&&(k.current&&clearTimeout(k.current),E("saving"),k.current=setTimeout(async()=>{try{await fetch("/api/plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:b.id,elements:w})}),E("saved"),setTimeout(()=>E("idle"),1200)}catch{E("idle")}},900))},[b,w]),L=(0,n.useMemo)(()=>w.find(e=>e.id===z),[w,z]),O=(0,n.useMemo)(()=>z?D.current.get(z)??null:null,[z,w]),M=(0,n.useMemo)(()=>{let e=new Map;for(let a of N)e.set(a.id,a.foreName);return e},[N]),A="lead"===j,$=(e,a,t)=>{A||y(r=>{let n=r.find(a=>a.id===e);if(!n)return r;let s=new Set((n.groupId?r.filter(e=>e.groupId===n.groupId):[n]).map(e=>e.id));return r.map(e=>s.has(e.id)?{...e,x:e.x+a,y:e.y+t}:e)})},W=e=>{A||(y(a=>{let t=a.find(a=>a.id===e);if(!t)return a;let r=t.groupId||null;for(let n of a)if(n.id!==e&&i(t,n)){r=r||n.groupId||d("grp");break}return r?a.map(a=>a.id===e||i(t,a)?{...a,groupId:r}:a):a.map(a=>a.id===e?{...a,groupId:null}:a)}),_())},K=(e,a)=>{if(A)return;let t={id:d("el"),type:e,refId:a??null,x:C?320:120,y:120,w:80,h:50,rotation:0,z:w.length,groupId:null,meta:{fontSize:12}};("WINDOW_SIDE"===e||"WALL_SIDE"===e)&&(t.w=240,t.h=8),"DOOR"===e&&(t.w=36,t.h=8),"TEACHER_DESK"===e&&(t.w=200,t.h=60),y(e=>[...e,t]),_()},[H,G]=(0,n.useState)({w:1200,h:700}),B=(0,n.useRef)(null),F=(0,n.useRef)(null);async function U(){if(!F.current)return;let{toPng:e}=await t.e(546).then(t.bind(t,7546)),a=await e(F.current,{cacheBust:!0,pixelRatio:2}),r=document.createElement("a");r.href=a,r.download=`sitzplan-${f}-${h}.png`,r.click()}async function J(){if(!F.current)return;let[{toPng:e},{jsPDF:a}]=await Promise.all([t.e(546).then(t.bind(t,7546)),t.e(296).then(t.bind(t,7296))]),r=await e(F.current,{cacheBust:!0,pixelRatio:2}),n=new a({orientation:"landscape",unit:"pt",format:"a4"}),s=n.internal.pageSize.getWidth(),l=n.internal.pageSize.getHeight(),d=new Image;d.src=r,await new Promise(e=>{d.onload=e});let i=Math.min(s/d.width,l/d.height),c=d.width*i,o=d.height*i;n.addImage(r,"PNG",(s-c)/2,(l-o)/2,c,o),n.save(`sitzplan-${f}-${h}.pdf`)}return(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-5",children:[(0,r.jsxs)("div",{className:"lg:col-span-5 min-h-[60vh] rounded border border-neutral-900 bg-neutral-950/40 relative",children:[(0,r.jsxs)("div",{className:"pointer-events-auto absolute right-3 top-3 z-10 flex items-center gap-2 text-xs",children:[r.jsx(l.z,{onClick:()=>T(!0),variant:"primary",disabled:!c||!f||!h,children:"Plan laden/erstellen"}),x&&(0,r.jsxs)("div",{className:"ml-2 flex items-center gap-2",children:[r.jsx("span",{className:"text-fg-muted",children:"Ansicht:"}),r.jsx(l.z,{onClick:()=>v("owner"),className:"owner"===j?"bg-primary/20 text-primary":"",children:"Eigen"}),r.jsx(l.z,{onClick:()=>v("lead"),className:"lead"===j?"bg-primary/20 text-primary":"",children:"KL"})]}),(0,r.jsxs)("div",{className:"text-fg-muted",children:["saving"===P&&r.jsx("span",{className:"ml-3",children:"Speichern…"}),"saved"===P&&r.jsx("span",{className:"ml-3 text-primary",children:"Gespeichert"})]})]}),r.jsx("div",{ref:B,className:"relative h-[70vh] w-full overflow-auto",children:(0,r.jsxs)("div",{ref:F,className:"relative",style:{width:H.w,height:H.h},onMouseDown:e=>{e.target===F.current&&I(null)},children:[("owner"===j?w:x?.elements||[]).map(e=>r.jsx("div",{role:"button",onClick:()=>!A&&I(e.id),className:`absolute select-none ${z===e.id?"ring-2 ring-primary/60":""}`,"data-el":e.id,style:{left:e.x,top:e.y,width:e.w,height:e.h,transform:`rotate(${e.rotation}deg)`,zIndex:e.z},ref:a=>{a?D.current.set(e.id,a):D.current.delete(e.id)},children:(0,r.jsxs)("div",{className:"h-full w-full rounded border border-neutral-700 bg-neutral-800/60 flex items-center justify-center",style:{fontSize:(e.meta?.fontSize??12)+"px"},children:["STUDENT"===e.type&&r.jsx("span",{children:e.refId?M.get(String(e.refId))||"Sch\xfcler":"Sch\xfcler (leer)"}),"TEACHER_DESK"===e.type&&r.jsx("span",{children:"Lehrerpult"}),"DOOR"===e.type&&r.jsx("span",{children:"T\xfcr"}),"WINDOW_SIDE"===e.type&&r.jsx("span",{children:"Fensterseite"}),"WALL_SIDE"===e.type&&r.jsx("span",{children:"Wandseite"})]})},e.id)),!A&&O&&r.jsx(s.ZP,{target:O,draggable:!0,resizable:!0,rotatable:!0,throttleDrag:0,throttleResize:0,throttleRotate:0,snappable:!0,snapThreshold:10,elementGuidelines:[],bounds:{left:0,top:0,right:H.w,bottom:H.h},onDrag:e=>{z&&$(z,e.beforeDelta[0],e.beforeDelta[1])},onDragEnd:()=>{z&&W(z)},onResize:e=>{z&&y(a=>a.map(a=>a.id===z?{...a,w:Math.max(10,e.width),h:Math.max(10,e.height),x:a.x+e.delta[0],y:a.y+e.delta[1]}:a))},onResizeEnd:()=>_(),onRotate:e=>{z&&y(a=>a.map(a=>a.id===z?{...a,rotation:e.beforeRotate}:a))},onRotateEnd:()=>_()})]})})]}),(0,r.jsxs)("aside",{className:`fixed left-0 top-[48px] z-20 h-[calc(100vh-48px)] w-72 transform border-r border-neutral-900 bg-bg-soft p-3 transition-transform ${C?"translate-x-0":"-translate-x-full"}`,children:[(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3 mb-3 grid gap-2",children:[r.jsx("div",{className:"text-sm font-medium mb-1",children:"Plan"}),r.jsx(l.z,{onClick:()=>T(!0),variant:"primary",disabled:!c||!f||!h,children:"Plan laden/erstellen"}),x&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[r.jsx("span",{className:"text-fg-muted",children:"Ansicht:"}),r.jsx(l.z,{onClick:()=>v("owner"),className:"owner"===j?"bg-primary/20 text-primary":"",children:"Eigen"}),r.jsx(l.z,{onClick:()=>v("lead"),className:"lead"===j?"bg-primary/20 text-primary":"",children:"KL"})]}),(0,r.jsxs)("div",{className:"text-xs text-fg-muted",children:["saving"===P&&r.jsx("span",{children:"Speichern…"}),"saved"===P&&r.jsx("span",{className:"text-primary",children:"Gespeichert"})]})]}),x&&"lead"===j&&(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3 grid gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:"KL-Plan"}),r.jsx("div",{className:"text-xs text-fg-muted",children:"Du kannst den Plan der Klassenleitung ansehen. \xc4nderungen sind hier nicht m\xf6glich."}),c&&r.jsx(l.z,{variant:"primary",onClick:async()=>{await fetch("/api/plan/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ownerProfileId:c.id,classId:f,roomId:h,sourcePlanId:x.id})}),v("owner"),await T(!1)},children:"Als Kopie \xfcbernehmen"})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3",children:[r.jsx("div",{className:"text-sm font-medium mb-2",children:"Palette"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[r.jsx(l.z,{onClick:()=>K("TEACHER_DESK"),children:"Lehrerpult"}),r.jsx(l.z,{onClick:()=>K("DOOR"),children:"T\xfcr"}),r.jsx(l.z,{onClick:()=>K("WINDOW_SIDE"),children:"Fensterseite"}),r.jsx(l.z,{onClick:()=>K("WALL_SIDE"),children:"Wandseite"})]})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3",children:[r.jsx("div",{className:"text-sm font-medium mb-2",children:"Sch\xfcler hinzuf\xfcgen"}),(0,r.jsxs)("div",{className:"grid gap-2 max-h-[260px] overflow-auto",children:[N.map(e=>r.jsx(l.z,{onClick:()=>K("STUDENT",e.id),className:"justify-start",children:e.foreName},e.id)),0===N.length&&r.jsx("div",{className:"text-xs text-fg-muted",children:"Keine Sch\xfcler geladen."})]})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3 grid gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:"Auswahl"}),!L&&r.jsx("div",{className:"text-xs text-fg-muted",children:"Nichts ausgew\xe4hlt"}),L&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"text-xs text-fg-muted",children:["Typ: ",L.type]}),(0,r.jsxs)("label",{className:"text-xs text-fg-muted flex items-center gap-2",children:[r.jsx("span",{children:"Schriftgr\xf6\xdfe"}),r.jsx("input",{type:"range",min:8,max:24,value:L.meta?.fontSize??12,onChange:e=>{let a=parseInt(e.target.value,10);y(e=>e.map(e=>e.id===L.id?{...e,meta:{...e.meta||{},fontSize:a}}:e)),_()}}),(0,r.jsxs)("span",{className:"tabular-nums",children:[L.meta?.fontSize??12,"px"]})]}),r.jsx("div",{className:"flex gap-2",children:r.jsx(l.z,{onClick:()=>{!A&&z&&(y(e=>e.filter(e=>e.id!==z)),I(null),_())},variant:"danger",children:"L\xf6schen"})})]})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3 grid gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:"Export"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(l.z,{onClick:U,children:"PNG"}),r.jsx(l.z,{onClick:J,children:"PDF (A4 Quer)"})]})]})]})]})}},8095:(e,a,t)=>{"use strict";t.d(a,{M:()=>d});var r=t(8570);let n=(0,r.createProxy)(String.raw`/Users/jz/Platzhirsch/components/editor/Editor.tsx`),{__esModule:s,$$typeof:l}=n;n.default;let d=(0,r.createProxy)(String.raw`/Users/jz/Platzhirsch/components/editor/Editor.tsx#Editor`)},1803:(e,a,t)=>{"use strict";t.r(a),t.d(a,{createClass:()=>i,deleteClass:()=>o,listClasses:()=>d,setClassLead:()=>c});var r=t(4330);t(166);var n=t(71),s=t(883),l=t(7708);async function d(){let e=(0,s.I)();if(!(0,s.u)(e,"read","class"))throw Error("forbidden");return n._.class.findMany({orderBy:{name:"asc"},include:{leadProfile:!0}})}async function i(e,a){let t=(0,s.I)();if(!(0,s.u)(t,"create","class"))throw Error("forbidden");let r=await n._.class.create({data:{name:e,leadProfileId:a||null}});return(0,l.revalidatePath)("/classes"),r}async function c(e,a){let t=(0,s.I)();if(!(0,s.u)(t,"update","class"))throw Error("forbidden");await n._.class.update({where:{id:e},data:{leadProfileId:a}}),(0,l.revalidatePath)("/classes")}async function o(e){let a=(0,s.I)();if(!(0,s.u)(a,"delete","class"))throw Error("forbidden");await n._.class.delete({where:{id:e}}),(0,l.revalidatePath)("/classes")}(0,t(618).h)([d,i,c,o]),(0,r.j)("b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d",d),(0,r.j)("4c018bc9b36e8e4ee0c64573afa34673fa514a06",i),(0,r.j)("7914dc5fbc064000e9e7e67beeae2d6d76de8861",c),(0,r.j)("1aad7720052bcbb3c3fff8073038f2a189fc9f98",o)},1379:(e,a,t)=>{"use strict";t.r(a),t.d(a,{createRoom:()=>c,deleteRoom:()=>o,listRooms:()=>i});var r=t(4330);t(166);var n=t(71),s=t(883),l=t(7708),d=t(3524);async function i(){let e=(0,s.I)();if(!(0,s.u)(e,"read","room"))throw Error("forbidden");return n._.room.findMany({orderBy:{name:"asc"}})}async function c(e,a="normal"){let t=(0,s.I)();if(!(0,s.u)(t,"create","room"))throw Error("forbidden");let r=await n._.room.create({data:{name:e,type:"adHoc"===a?d.RoomType.ADHOC:d.RoomType.NORMAL}});return(0,l.revalidatePath)("/rooms"),r}async function o(e){let a=(0,s.I)();if(!(0,s.u)(a,"delete","room"))throw Error("forbidden");await n._.room.delete({where:{id:e}}),(0,l.revalidatePath)("/rooms")}(0,t(618).h)([i,c,o]),(0,r.j)("8a57dfb094cf75dda1cd39da095655f2cc8d362e",i),(0,r.j)("51a097bff94b6d7bde5cfb7a76cc419ca2d2d897",c),(0,r.j)("88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0",o)},71:(e,a,t)=>{"use strict";t.d(a,{_:()=>n});var r=t(3524);let n=globalThis.prisma??new r.PrismaClient({log:["error"]})},883:(e,a,t)=>{"use strict";function r(){return{id:"anonymous",role:"anonymous"}}function n(e,a,t){return!0}t.d(a,{I:()=>r,u:()=>n})}};