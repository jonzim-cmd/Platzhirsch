exports.id=169,exports.ids=[169],exports.modules={9363:(e,a,t)=>{let r={"1aad7720052bcbb3c3fff8073038f2a189fc9f98":()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.deleteClass),"4c018bc9b36e8e4ee0c64573afa34673fa514a06":()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.createClass),"7914dc5fbc064000e9e7e67beeae2d6d76de8861":()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.setClassLead),b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d:()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.listClasses),"51a097bff94b6d7bde5cfb7a76cc419ca2d2d897":()=>Promise.resolve().then(t.bind(t,1379)).then(e=>e.createRoom),"88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0":()=>Promise.resolve().then(t.bind(t,1379)).then(e=>e.deleteRoom),"8a57dfb094cf75dda1cd39da095655f2cc8d362e":()=>Promise.resolve().then(t.bind(t,1379)).then(e=>e.listRooms)};async function s(e,...a){return(await r[e]()).apply(null,a)}e.exports={"1aad7720052bcbb3c3fff8073038f2a189fc9f98":s.bind(null,"1aad7720052bcbb3c3fff8073038f2a189fc9f98"),"4c018bc9b36e8e4ee0c64573afa34673fa514a06":s.bind(null,"4c018bc9b36e8e4ee0c64573afa34673fa514a06"),"7914dc5fbc064000e9e7e67beeae2d6d76de8861":s.bind(null,"7914dc5fbc064000e9e7e67beeae2d6d76de8861"),b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d:s.bind(null,"b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d"),"51a097bff94b6d7bde5cfb7a76cc419ca2d2d897":s.bind(null,"51a097bff94b6d7bde5cfb7a76cc419ca2d2d897"),"88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0":s.bind(null,"88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0"),"8a57dfb094cf75dda1cd39da095655f2cc8d362e":s.bind(null,"8a57dfb094cf75dda1cd39da095655f2cc8d362e")}},9371:(e,a,t)=>{Promise.resolve().then(t.bind(t,342))},342:(e,a,t)=>{"use strict";t.d(a,{Editor:()=>c});var r=t(326),s=t(7577),d=t(2816),n=t(3679);function i(e="id"){return`${e}_${Math.random().toString(36).slice(2,9)}`}function l(e,a){let t={left:e.x,top:e.y,right:e.x+e.w,bottom:e.y+e.h},r={left:a.x,top:a.y,right:a.x+a.w,bottom:a.y+a.h};return!(t.right<r.left||t.left>r.right||t.bottom<r.top||t.top>r.bottom)}function c({classes:e,rooms:a}){let[c,o]=(0,s.useState)(null),[f,h]=(0,s.useState)(""),[u,m]=(0,s.useState)(""),[b,x]=(0,s.useState)(null),[p,g]=(0,s.useState)(null),[j,v]=(0,s.useState)("owner"),[y,w]=(0,s.useState)([]),[N,S]=(0,s.useState)([]),[P,I]=(0,s.useState)(null),[E,z]=(0,s.useState)("idle"),[C,R]=(0,s.useState)(!1),D=(0,s.useRef)(null),k=(0,s.useCallback)(async e=>{if(!c?.id||!f||!u)return;let a=await fetch(`/api/plan?ownerProfileId=${c.id}&classId=${f}&roomId=${u}&create=${e?"1":"0"}&includeLead=1`);if(!a.ok)return;let t=await a.json();x(t.plan),g(t.leadPlan),w(t.plan.elements.map(e=>({...e}))),I(null)},[c?.id,f,u]),T=(0,s.useCallback)(()=>{b&&(D.current&&clearTimeout(D.current),z("saving"),D.current=setTimeout(async()=>{try{await fetch("/api/plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:b.id,elements:y})}),z("saved"),setTimeout(()=>z("idle"),1200)}catch{z("idle")}},900))},[b,y]),_=(0,s.useMemo)(()=>y.find(e=>e.id===P),[y,P]),L="lead"===j,O=(e,a,t)=>{L||w(r=>{let s=r.find(a=>a.id===e);if(!s)return r;let d=new Set((s.groupId?r.filter(e=>e.groupId===s.groupId):[s]).map(e=>e.id));return r.map(e=>d.has(e.id)?{...e,x:e.x+a,y:e.y+t}:e)})},$=e=>{L||(w(a=>{let t=a.find(a=>a.id===e);if(!t)return a;let r=t.groupId||null;for(let s of a)if(s.id!==e&&l(t,s)){r=r||s.groupId||i("grp");break}return r?a.map(a=>a.id===e||l(t,a)?{...a,groupId:r}:a):a.map(a=>a.id===e?{...a,groupId:null}:a)}),T())},A=(e,a)=>{if(L)return;let t={id:i("el"),type:e,refId:a??null,x:120,y:120,w:80,h:50,rotation:0,z:y.length,groupId:null};("WINDOW_SIDE"===e||"WALL_SIDE"===e)&&(t.w=240,t.h=8),"DOOR"===e&&(t.w=36,t.h=8),"TEACHER_DESK"===e&&(t.w=200,t.h=60),w(e=>[...e,t]),T()},[W,K]=(0,s.useState)({w:1200,h:700}),M=(0,s.useRef)(null),H=(0,s.useRef)(null);async function G(){if(!H.current)return;let{toPng:e}=await t.e(546).then(t.bind(t,7546)),a=await e(H.current,{cacheBust:!0,pixelRatio:2}),r=document.createElement("a");r.href=a,r.download=`sitzplan-${f}-${u}.png`,r.click()}async function B(){if(!H.current)return;let[{toPng:e},{jsPDF:a}]=await Promise.all([t.e(546).then(t.bind(t,7546)),t.e(296).then(t.bind(t,7296))]),r=await e(H.current,{cacheBust:!0,pixelRatio:2}),s=new a({orientation:"landscape",unit:"pt",format:"a4"}),d=s.internal.pageSize.getWidth(),n=s.internal.pageSize.getHeight(),i=new Image;i.src=r,await new Promise(e=>{i.onload=e});let l=Math.min(d/i.width,n/i.height),c=i.width*l,o=i.height*l;s.addImage(r,"PNG",(d-c)/2,(n-o)/2,c,o),s.save(`sitzplan-${f}-${u}.pdf`)}return(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-5",children:[(0,r.jsxs)("div",{className:"lg:col-span-5 min-h-[60vh] rounded border border-neutral-900 bg-neutral-950/40 relative",children:[(0,r.jsxs)("div",{className:"pointer-events-auto absolute right-3 top-3 z-10 flex items-center gap-2 text-xs",children:[r.jsx(n.z,{onClick:()=>k(!0),variant:"primary",disabled:!c||!f||!u,children:"Plan laden/erstellen"}),p&&(0,r.jsxs)("div",{className:"ml-2 flex items-center gap-2",children:[r.jsx("span",{className:"text-fg-muted",children:"Ansicht:"}),r.jsx(n.z,{onClick:()=>v("owner"),className:"owner"===j?"bg-primary/20 text-primary":"",children:"Eigen"}),r.jsx(n.z,{onClick:()=>v("lead"),className:"lead"===j?"bg-primary/20 text-primary":"",children:"KL"})]}),(0,r.jsxs)("div",{className:"text-fg-muted",children:["saving"===E&&r.jsx("span",{className:"ml-3",children:"Speichern…"}),"saved"===E&&r.jsx("span",{className:"ml-3 text-primary",children:"Gespeichert"})]})]}),r.jsx("div",{ref:M,className:"relative h-[70vh] w-full overflow-auto",children:r.jsx("div",{ref:H,className:"relative",style:{width:W.w,height:W.h},children:("owner"===j?y:p?.elements||[]).map(e=>(0,r.jsxs)("div",{role:"button",onClick:()=>!L&&I(e.id),className:`absolute select-none ${P===e.id?"ring-2 ring-primary/60":""}`,"data-el":e.id,style:{left:e.x,top:e.y,width:e.w,height:e.h,transform:`rotate(${e.rotation}deg)`,zIndex:e.z},children:[(0,r.jsxs)("div",{className:"h-full w-full rounded border border-neutral-700 bg-neutral-800/60 flex items-center justify-center text-xs",children:["STUDENT"===e.type&&(0,r.jsxs)("span",{children:["Sch\xfcler",e.refId?"":" (leer)"]}),"TEACHER_DESK"===e.type&&r.jsx("span",{children:"Lehrerpult"}),"DOOR"===e.type&&r.jsx("span",{children:"T\xfcr"}),"WINDOW_SIDE"===e.type&&r.jsx("span",{children:"Fensterseite"}),"WALL_SIDE"===e.type&&r.jsx("span",{children:"Wandseite"})]}),!L&&P===e.id&&r.jsx(d.ZP,{target:()=>document.querySelector(`[data-el='${e.id}']`),draggable:!0,resizable:!0,rotatable:!0,throttleDrag:0,throttleResize:0,throttleRotate:0,snappable:!0,snapThreshold:10,elementGuidelines:[],bounds:{left:0,top:0,right:W.w,bottom:W.h},onDrag:a=>{let t=a.beforeDelta[0],r=a.beforeDelta[1];O(e.id,t,r)},onDragEnd:()=>$(e.id),onResize:a=>{w(t=>t.map(t=>t.id===e.id?{...t,w:Math.max(10,a.width),h:Math.max(10,a.height),x:t.x+a.delta[0],y:t.y+a.delta[1]}:t))},onResizeEnd:()=>T(),onRotate:a=>{w(t=>t.map(t=>t.id===e.id?{...t,rotation:a.beforeRotate}:t))},onRotateEnd:()=>T()})]},e.id))})})]}),(0,r.jsxs)("aside",{className:`fixed left-0 top-[48px] z-20 h-[calc(100vh-48px)] w-72 transform border-r border-neutral-900 bg-bg-soft p-3 transition-transform ${C?"translate-x-0":"-translate-x-full"}`,children:[(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3 mb-3 grid gap-2",children:[r.jsx("div",{className:"text-sm font-medium mb-1",children:"Plan"}),r.jsx(n.z,{onClick:()=>k(!0),variant:"primary",disabled:!c||!f||!u,children:"Plan laden/erstellen"}),p&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[r.jsx("span",{className:"text-fg-muted",children:"Ansicht:"}),r.jsx(n.z,{onClick:()=>v("owner"),className:"owner"===j?"bg-primary/20 text-primary":"",children:"Eigen"}),r.jsx(n.z,{onClick:()=>v("lead"),className:"lead"===j?"bg-primary/20 text-primary":"",children:"KL"})]}),(0,r.jsxs)("div",{className:"text-xs text-fg-muted",children:["saving"===E&&r.jsx("span",{children:"Speichern…"}),"saved"===E&&r.jsx("span",{className:"text-primary",children:"Gespeichert"})]})]}),p&&"lead"===j&&(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3 grid gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:"KL-Plan"}),r.jsx("div",{className:"text-xs text-fg-muted",children:"Du kannst den Plan der Klassenleitung ansehen. \xc4nderungen sind hier nicht m\xf6glich."}),c&&r.jsx(n.z,{variant:"primary",onClick:async()=>{await fetch("/api/plan/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ownerProfileId:c.id,classId:f,roomId:u,sourcePlanId:p.id})}),v("owner"),await k(!1)},children:"Als Kopie \xfcbernehmen"})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3",children:[r.jsx("div",{className:"text-sm font-medium mb-2",children:"Palette"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[r.jsx(n.z,{onClick:()=>A("TEACHER_DESK"),children:"Lehrerpult"}),r.jsx(n.z,{onClick:()=>A("DOOR"),children:"T\xfcr"}),r.jsx(n.z,{onClick:()=>A("WINDOW_SIDE"),children:"Fensterseite"}),r.jsx(n.z,{onClick:()=>A("WALL_SIDE"),children:"Wandseite"})]})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3",children:[r.jsx("div",{className:"text-sm font-medium mb-2",children:"Sch\xfcler hinzuf\xfcgen"}),(0,r.jsxs)("div",{className:"grid gap-2 max-h-[260px] overflow-auto",children:[N.map(e=>r.jsx(n.z,{onClick:()=>A("STUDENT",e.id),className:"justify-start",children:e.foreName},e.id)),0===N.length&&r.jsx("div",{className:"text-xs text-fg-muted",children:"Keine Sch\xfcler geladen."})]})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3 grid gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:"Auswahl"}),!_&&r.jsx("div",{className:"text-xs text-fg-muted",children:"Nichts ausgew\xe4hlt"}),_&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"text-xs text-fg-muted",children:["Typ: ",_.type]}),r.jsx("div",{className:"flex gap-2",children:r.jsx(n.z,{onClick:()=>{!L&&P&&(w(e=>e.filter(e=>e.id!==P)),I(null),T())},variant:"danger",children:"L\xf6schen"})})]})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3 grid gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:"Export"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(n.z,{onClick:G,children:"PNG"}),r.jsx(n.z,{onClick:B,children:"PDF (A4 Quer)"})]})]})]})]})}},8095:(e,a,t)=>{"use strict";t.d(a,{M:()=>i});var r=t(8570);let s=(0,r.createProxy)(String.raw`/Users/jz/Platzhirsch/components/editor/Editor.tsx`),{__esModule:d,$$typeof:n}=s;s.default;let i=(0,r.createProxy)(String.raw`/Users/jz/Platzhirsch/components/editor/Editor.tsx#Editor`)},1803:(e,a,t)=>{"use strict";t.r(a),t.d(a,{createClass:()=>l,deleteClass:()=>o,listClasses:()=>i,setClassLead:()=>c});var r=t(4330);t(166);var s=t(71),d=t(883),n=t(7708);async function i(){let e=(0,d.I)();if(!(0,d.u)(e,"read","class"))throw Error("forbidden");return s._.class.findMany({orderBy:{name:"asc"},include:{leadProfile:!0}})}async function l(e,a){let t=(0,d.I)();if(!(0,d.u)(t,"create","class"))throw Error("forbidden");let r=await s._.class.create({data:{name:e,leadProfileId:a||null}});return(0,n.revalidatePath)("/classes"),r}async function c(e,a){let t=(0,d.I)();if(!(0,d.u)(t,"update","class"))throw Error("forbidden");await s._.class.update({where:{id:e},data:{leadProfileId:a}}),(0,n.revalidatePath)("/classes")}async function o(e){let a=(0,d.I)();if(!(0,d.u)(a,"delete","class"))throw Error("forbidden");await s._.class.delete({where:{id:e}}),(0,n.revalidatePath)("/classes")}(0,t(618).h)([i,l,c,o]),(0,r.j)("b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d",i),(0,r.j)("4c018bc9b36e8e4ee0c64573afa34673fa514a06",l),(0,r.j)("7914dc5fbc064000e9e7e67beeae2d6d76de8861",c),(0,r.j)("1aad7720052bcbb3c3fff8073038f2a189fc9f98",o)},1379:(e,a,t)=>{"use strict";t.r(a),t.d(a,{createRoom:()=>c,deleteRoom:()=>o,listRooms:()=>l});var r=t(4330);t(166);var s=t(71),d=t(883),n=t(7708),i=t(3524);async function l(){let e=(0,d.I)();if(!(0,d.u)(e,"read","room"))throw Error("forbidden");return s._.room.findMany({orderBy:{name:"asc"}})}async function c(e,a="normal"){let t=(0,d.I)();if(!(0,d.u)(t,"create","room"))throw Error("forbidden");let r=await s._.room.create({data:{name:e,type:"adHoc"===a?i.RoomType.ADHOC:i.RoomType.NORMAL}});return(0,n.revalidatePath)("/rooms"),r}async function o(e){let a=(0,d.I)();if(!(0,d.u)(a,"delete","room"))throw Error("forbidden");await s._.room.delete({where:{id:e}}),(0,n.revalidatePath)("/rooms")}(0,t(618).h)([l,c,o]),(0,r.j)("8a57dfb094cf75dda1cd39da095655f2cc8d362e",l),(0,r.j)("51a097bff94b6d7bde5cfb7a76cc419ca2d2d897",c),(0,r.j)("88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0",o)},71:(e,a,t)=>{"use strict";t.d(a,{_:()=>s});var r=t(3524);let s=globalThis.prisma??new r.PrismaClient({log:["error"]})},883:(e,a,t)=>{"use strict";function r(){return{id:"anonymous",role:"anonymous"}}function s(e,a,t){return!0}t.d(a,{I:()=>r,u:()=>s})}};