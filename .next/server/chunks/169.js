exports.id=169,exports.ids=[169],exports.modules={9363:(e,a,t)=>{let r={"1aad7720052bcbb3c3fff8073038f2a189fc9f98":()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.deleteClass),"4c018bc9b36e8e4ee0c64573afa34673fa514a06":()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.createClass),"7914dc5fbc064000e9e7e67beeae2d6d76de8861":()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.setClassLead),b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d:()=>Promise.resolve().then(t.bind(t,1803)).then(e=>e.listClasses),"51a097bff94b6d7bde5cfb7a76cc419ca2d2d897":()=>Promise.resolve().then(t.bind(t,1379)).then(e=>e.createRoom),"88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0":()=>Promise.resolve().then(t.bind(t,1379)).then(e=>e.deleteRoom),"8a57dfb094cf75dda1cd39da095655f2cc8d362e":()=>Promise.resolve().then(t.bind(t,1379)).then(e=>e.listRooms)};async function d(e,...a){return(await r[e]()).apply(null,a)}e.exports={"1aad7720052bcbb3c3fff8073038f2a189fc9f98":d.bind(null,"1aad7720052bcbb3c3fff8073038f2a189fc9f98"),"4c018bc9b36e8e4ee0c64573afa34673fa514a06":d.bind(null,"4c018bc9b36e8e4ee0c64573afa34673fa514a06"),"7914dc5fbc064000e9e7e67beeae2d6d76de8861":d.bind(null,"7914dc5fbc064000e9e7e67beeae2d6d76de8861"),b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d:d.bind(null,"b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d"),"51a097bff94b6d7bde5cfb7a76cc419ca2d2d897":d.bind(null,"51a097bff94b6d7bde5cfb7a76cc419ca2d2d897"),"88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0":d.bind(null,"88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0"),"8a57dfb094cf75dda1cd39da095655f2cc8d362e":d.bind(null,"8a57dfb094cf75dda1cd39da095655f2cc8d362e")}},9371:(e,a,t)=>{Promise.resolve().then(t.bind(t,342))},342:(e,a,t)=>{"use strict";t.d(a,{Editor:()=>c});var r=t(326),d=t(7577),n=t(2816),s=t(3679);function l(e="id"){return`${e}_${Math.random().toString(36).slice(2,9)}`}function i(e,a){let t={left:e.x,top:e.y,right:e.x+e.w,bottom:e.y+e.h},r={left:a.x,top:a.y,right:a.x+a.w,bottom:a.y+a.h};return!(t.right<r.left||t.left>r.right||t.bottom<r.top||t.top>r.bottom)}function c({classes:e,rooms:a}){let[c,o]=(0,d.useState)(null),[f,u]=(0,d.useState)(""),[h,m]=(0,d.useState)(""),[b,p]=(0,d.useState)(null),[x,g]=(0,d.useState)(null),[j,v]=(0,d.useState)("owner"),[w,y]=(0,d.useState)([]),[N,S]=(0,d.useState)([]),[I,P]=(0,d.useState)(null),[E,z]=(0,d.useState)("idle"),[C,R]=(0,d.useState)(!1),D=(0,d.useRef)(null),k=(0,d.useCallback)(async e=>{if(!c?.id||!f||!h)return;let a=await fetch(`/api/plan?ownerProfileId=${c.id}&classId=${f}&roomId=${h}&create=${e?"1":"0"}&includeLead=1`);if(!a.ok)return;let t=await a.json();p(t.plan),g(t.leadPlan),y(t.plan.elements.map(e=>({...e}))),P(null)},[c?.id,f,h]),T=(0,d.useCallback)(()=>{b&&(D.current&&clearTimeout(D.current),z("saving"),D.current=setTimeout(async()=>{try{await fetch("/api/plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:b.id,elements:w})}),z("saved"),setTimeout(()=>z("idle"),1200)}catch{z("idle")}},900))},[b,w]),_=(0,d.useMemo)(()=>w.find(e=>e.id===I),[w,I]),L="lead"===j,O=(e,a,t)=>{L||y(r=>{let d=r.find(a=>a.id===e);if(!d)return r;let n=new Set((d.groupId?r.filter(e=>e.groupId===d.groupId):[d]).map(e=>e.id));return r.map(e=>n.has(e.id)?{...e,x:e.x+a,y:e.y+t}:e)})},W=e=>{L||(y(a=>{let t=a.find(a=>a.id===e);if(!t)return a;let r=t.groupId||null;for(let d of a)if(d.id!==e&&i(t,d)){r=r||d.groupId||l("grp");break}return r?a.map(a=>a.id===e||i(t,a)?{...a,groupId:r}:a):a.map(a=>a.id===e?{...a,groupId:null}:a)}),T())},$=(e,a)=>{if(L)return;let t={id:l("el"),type:e,refId:a??null,x:120,y:120,w:80,h:50,rotation:0,z:w.length,groupId:null};("WINDOW_SIDE"===e||"WALL_SIDE"===e)&&(t.w=240,t.h=8),"DOOR"===e&&(t.w=36,t.h=8),"TEACHER_DESK"===e&&(t.w=200,t.h=60),y(e=>[...e,t]),T()},[A,M]=(0,d.useState)({w:1200,h:700}),K=(0,d.useRef)(null),H=(0,d.useRef)(null);async function B(){if(!H.current)return;let{toPng:e}=await t.e(546).then(t.bind(t,7546)),a=await e(H.current,{cacheBust:!0,pixelRatio:2}),r=document.createElement("a");r.href=a,r.download=`sitzplan-${f}-${h}.png`,r.click()}async function F(){if(!H.current)return;let[{toPng:e},{jsPDF:a}]=await Promise.all([t.e(546).then(t.bind(t,7546)),t.e(296).then(t.bind(t,7296))]),r=await e(H.current,{cacheBust:!0,pixelRatio:2}),d=new a({orientation:"landscape",unit:"pt",format:"a4"}),n=d.internal.pageSize.getWidth(),s=d.internal.pageSize.getHeight(),l=new Image;l.src=r,await new Promise(e=>{l.onload=e});let i=Math.min(n/l.width,s/l.height),c=l.width*i,o=l.height*i;d.addImage(r,"PNG",(n-c)/2,(s-o)/2,c,o),d.save(`sitzplan-${f}-${h}.pdf`)}return(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-5",children:[(0,r.jsxs)("div",{className:"lg:col-span-5 min-h-[60vh] rounded border border-neutral-900 bg-neutral-950/40 relative",children:[(0,r.jsxs)("div",{className:"pointer-events-auto absolute right-3 top-3 z-10 flex items-center gap-2 text-xs",children:[r.jsx(s.z,{onClick:()=>k(!0),variant:"primary",disabled:!c||!f||!h,children:"Plan laden/erstellen"}),x&&(0,r.jsxs)("div",{className:"ml-2 flex items-center gap-2",children:[r.jsx("span",{className:"text-fg-muted",children:"Ansicht:"}),r.jsx(s.z,{onClick:()=>v("owner"),className:"owner"===j?"bg-primary/20 text-primary":"",children:"Eigen"}),r.jsx(s.z,{onClick:()=>v("lead"),className:"lead"===j?"bg-primary/20 text-primary":"",children:"KL"})]}),(0,r.jsxs)("div",{className:"text-fg-muted",children:["saving"===E&&r.jsx("span",{className:"ml-3",children:"Speichern…"}),"saved"===E&&r.jsx("span",{className:"ml-3 text-primary",children:"Gespeichert"})]})]}),r.jsx("div",{ref:K,className:"relative h-[70vh] w-full overflow-auto",children:r.jsx("div",{ref:H,className:"relative",style:{width:A.w,height:A.h},children:("owner"===j?w:x?.elements||[]).map(e=>(0,r.jsxs)("div",{role:"button",onClick:()=>!L&&P(e.id),className:`absolute select-none ${I===e.id?"ring-2 ring-primary/60":""}`,"data-el":e.id,style:{left:e.x,top:e.y,width:e.w,height:e.h,transform:`rotate(${e.rotation}deg)`,zIndex:e.z},children:[(0,r.jsxs)("div",{className:"h-full w-full rounded border border-neutral-700 bg-neutral-800/60 flex items-center justify-center text-xs",children:["STUDENT"===e.type&&(0,r.jsxs)("span",{children:["Sch\xfcler",e.refId?"":" (leer)"]}),"TEACHER_DESK"===e.type&&r.jsx("span",{children:"Lehrerpult"}),"DOOR"===e.type&&r.jsx("span",{children:"T\xfcr"}),"WINDOW_SIDE"===e.type&&r.jsx("span",{children:"Fensterseite"}),"WALL_SIDE"===e.type&&r.jsx("span",{children:"Wandseite"})]}),!L&&I===e.id&&r.jsx(n.ZP,{target:()=>document.querySelector(`[data-el='${e.id}']`),draggable:!0,resizable:!0,rotatable:!0,throttleDrag:0,throttleResize:0,throttleRotate:0,snappable:!0,snapThreshold:10,elementGuidelines:[],bounds:{left:0,top:0,right:A.w,bottom:A.h},onDrag:a=>{let t=a.beforeDelta[0],r=a.beforeDelta[1];O(e.id,t,r)},onDragEnd:()=>W(e.id),onResize:a=>{y(t=>t.map(t=>t.id===e.id?{...t,w:Math.max(10,a.width),h:Math.max(10,a.height),x:t.x+a.delta[0],y:t.y+a.delta[1]}:t))},onResizeEnd:()=>T(),onRotate:a=>{y(t=>t.map(t=>t.id===e.id?{...t,rotation:a.beforeRotate}:t))},onRotateEnd:()=>T()})]},e.id))})})]}),(0,r.jsxs)("aside",{className:`fixed left-0 top-[48px] z-20 h-[calc(100vh-48px)] w-72 transform border-r border-neutral-900 bg-bg-soft p-3 transition-transform ${C?"translate-x-0":"-translate-x-full"}`,children:[x&&"lead"===j&&(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3 grid gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:"KL-Plan"}),r.jsx("div",{className:"text-xs text-fg-muted",children:"Du kannst den Plan der Klassenleitung ansehen. \xc4nderungen sind hier nicht m\xf6glich."}),c&&r.jsx(s.z,{variant:"primary",onClick:async()=>{await fetch("/api/plan/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ownerProfileId:c.id,classId:f,roomId:h,sourcePlanId:x.id})}),v("owner"),await k(!1)},children:"Als Kopie \xfcbernehmen"})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3",children:[r.jsx("div",{className:"text-sm font-medium mb-2",children:"Palette"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[r.jsx(s.z,{onClick:()=>$("TEACHER_DESK"),children:"Lehrerpult"}),r.jsx(s.z,{onClick:()=>$("DOOR"),children:"T\xfcr"}),r.jsx(s.z,{onClick:()=>$("WINDOW_SIDE"),children:"Fensterseite"}),r.jsx(s.z,{onClick:()=>$("WALL_SIDE"),children:"Wandseite"})]})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3",children:[r.jsx("div",{className:"text-sm font-medium mb-2",children:"Sch\xfcler hinzuf\xfcgen"}),(0,r.jsxs)("div",{className:"grid gap-2 max-h-[260px] overflow-auto",children:[N.map(e=>r.jsx(s.z,{onClick:()=>$("STUDENT",e.id),className:"justify-start",children:e.foreName},e.id)),0===N.length&&r.jsx("div",{className:"text-xs text-fg-muted",children:"Keine Sch\xfcler geladen."})]})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3 grid gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:"Auswahl"}),!_&&r.jsx("div",{className:"text-xs text-fg-muted",children:"Nichts ausgew\xe4hlt"}),_&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"text-xs text-fg-muted",children:["Typ: ",_.type]}),r.jsx("div",{className:"flex gap-2",children:r.jsx(s.z,{onClick:()=>{!L&&I&&(y(e=>e.filter(e=>e.id!==I)),P(null),T())},variant:"danger",children:"L\xf6schen"})})]})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3 grid gap-2",children:[r.jsx("div",{className:"text-sm font-medium",children:"Export"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(s.z,{onClick:B,children:"PNG"}),r.jsx(s.z,{onClick:F,children:"PDF (A4 Quer)"})]})]})]}),r.jsx("button",{"aria-label":"Werkzeuge",onClick:()=>R(e=>!e),className:"fixed left-2 top-[56px] z-30 rounded bg-neutral-800 px-2 py-1 text-sm hover:bg-neutral-700",children:C?"⟨ schlie\xdfen":"Werkzeuge ⟩"})]})}},8095:(e,a,t)=>{"use strict";t.d(a,{M:()=>l});var r=t(8570);let d=(0,r.createProxy)(String.raw`/Users/jz/Platzhirsch/components/editor/Editor.tsx`),{__esModule:n,$$typeof:s}=d;d.default;let l=(0,r.createProxy)(String.raw`/Users/jz/Platzhirsch/components/editor/Editor.tsx#Editor`)},1803:(e,a,t)=>{"use strict";t.r(a),t.d(a,{createClass:()=>i,deleteClass:()=>o,listClasses:()=>l,setClassLead:()=>c});var r=t(4330);t(166);var d=t(71),n=t(883),s=t(7708);async function l(){let e=(0,n.I)();if(!(0,n.u)(e,"read","class"))throw Error("forbidden");return d._.class.findMany({orderBy:{name:"asc"},include:{leadProfile:!0}})}async function i(e,a){let t=(0,n.I)();if(!(0,n.u)(t,"create","class"))throw Error("forbidden");let r=await d._.class.create({data:{name:e,leadProfileId:a||null}});return(0,s.revalidatePath)("/classes"),r}async function c(e,a){let t=(0,n.I)();if(!(0,n.u)(t,"update","class"))throw Error("forbidden");await d._.class.update({where:{id:e},data:{leadProfileId:a}}),(0,s.revalidatePath)("/classes")}async function o(e){let a=(0,n.I)();if(!(0,n.u)(a,"delete","class"))throw Error("forbidden");await d._.class.delete({where:{id:e}}),(0,s.revalidatePath)("/classes")}(0,t(618).h)([l,i,c,o]),(0,r.j)("b1a86aeaa537ef061ece06ae838f0f0fbfb3aa3d",l),(0,r.j)("4c018bc9b36e8e4ee0c64573afa34673fa514a06",i),(0,r.j)("7914dc5fbc064000e9e7e67beeae2d6d76de8861",c),(0,r.j)("1aad7720052bcbb3c3fff8073038f2a189fc9f98",o)},1379:(e,a,t)=>{"use strict";t.r(a),t.d(a,{createRoom:()=>c,deleteRoom:()=>o,listRooms:()=>i});var r=t(4330);t(166);var d=t(71),n=t(883),s=t(7708),l=t(3524);async function i(){let e=(0,n.I)();if(!(0,n.u)(e,"read","room"))throw Error("forbidden");return d._.room.findMany({orderBy:{name:"asc"}})}async function c(e,a="normal"){let t=(0,n.I)();if(!(0,n.u)(t,"create","room"))throw Error("forbidden");let r=await d._.room.create({data:{name:e,type:"adHoc"===a?l.RoomType.ADHOC:l.RoomType.NORMAL}});return(0,s.revalidatePath)("/rooms"),r}async function o(e){let a=(0,n.I)();if(!(0,n.u)(a,"delete","room"))throw Error("forbidden");await d._.room.delete({where:{id:e}}),(0,s.revalidatePath)("/rooms")}(0,t(618).h)([i,c,o]),(0,r.j)("8a57dfb094cf75dda1cd39da095655f2cc8d362e",i),(0,r.j)("51a097bff94b6d7bde5cfb7a76cc419ca2d2d897",c),(0,r.j)("88a28fa01bf8eb3ed6954f8a4f4ae43143c0f7e0",o)},71:(e,a,t)=>{"use strict";t.d(a,{_:()=>d});var r=t(3524);let d=globalThis.prisma??new r.PrismaClient({log:["error"]})},883:(e,a,t)=>{"use strict";function r(){return{id:"anonymous",role:"anonymous"}}function d(e,a,t){return!0}t.d(a,{I:()=>r,u:()=>d})}};