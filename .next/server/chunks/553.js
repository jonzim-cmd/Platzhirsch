exports.id=553,exports.ids=[553],exports.modules={3526:(e,t,s)=>{Promise.resolve().then(s.bind(s,6795))},8804:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},6795:(e,t,s)=>{"use strict";s.d(t,{TopBar:()=>u});var r=s(326),a=s(7577),l=s(3679);let n=a.forwardRef(({label:e,className:t="",...s},a)=>(0,r.jsxs)("label",{className:"grid gap-2 text-sm",children:[e?r.jsx("span",{className:"text-fg-muted",children:e}):null,r.jsx("input",{ref:a,className:"rounded border border-neutral-800 bg-neutral-900 px-3 py-2 outline-none ring-0 focus:border-neutral-600 "+t,...s})]}));n.displayName="Input";var i=s(9418),d=s(962);function o({children:e,onClose:t}){let s=(0,r.jsxs)("div",{"aria-modal":"true",role:"dialog",className:"fixed inset-0",style:{zIndex:i.Z.modal},children:[r.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:t}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4 overflow-auto",children:e})]});return"undefined"==typeof document?null:(0,d.createPortal)(s,document.body)}var c=s(5698);function h({createMode:e,profile:t,onClose:s}){let[i,d]=(0,a.useState)(t?.name||""),[h,u]=(0,a.useState)([]),[m,x]=(0,a.useState)(!1),[p,f]=(0,a.useState)(!1),[g,j]=(0,a.useState)(!1);async function b(){x(!0);try{let r=t?.id||"";for(let s of(e?r=(await fetch("/api/profiles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i})}).then(e=>e.json())).id:i!==t?.name&&await fetch(`/api/profiles/${t?.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i})}),h)){let e=!!s.assigned;await fetch("/api/profile-classes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileId:r,classId:s.id,assigned:e})})}for(let e of h){let t=e.leadProfileId===r;await fetch("/api/class/lead",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:e.id,leadProfileId:t?r:null})})}j(!0),s(!0)}finally{x(!1)}}return r.jsx(o,{onClose:()=>s(!1),children:(0,r.jsxs)("div",{className:"w-[min(90vw,800px)] max-h-[85vh] overflow-auto rounded border border-neutral-800 bg-bg-soft p-4 shadow-xl",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"text-lg font-medium",children:e?"Profil anlegen":"Profil bearbeiten"}),r.jsx("button",{className:"text-fg-muted hover:text-fg",onClick:()=>s(!!g),children:"✕"})]}),(0,r.jsxs)("div",{className:"mt-4 grid gap-4",children:[r.jsx(n,{label:"Name",value:i,onChange:e=>d(e.target.value),placeholder:"z. B. Frau M\xfcller"}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"mb-2 text-sm font-medium",children:"Klassen (Zuweisung + Klassenleitung)"}),r.jsx("div",{className:"max-h-[40vh] overflow-auto rounded border border-neutral-900",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[r.jsx("thead",{className:"bg-neutral-900/50",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-3 py-2 text-left",children:"Zugewiesen"}),r.jsx("th",{className:"px-3 py-2 text-left",children:"Klasse"}),r.jsx("th",{className:"px-3 py-2 text-left",children:"KL"})]})}),(0,r.jsxs)("tbody",{children:[h.map(e=>(0,r.jsxs)("tr",{className:"border-t border-neutral-900",children:[r.jsx("td",{className:"px-3 py-2",children:r.jsx("input",{type:"checkbox",checked:e.assigned,onChange:()=>{var t;return t=e.id,void(u(e=>e.map(e=>e.id===t?{...e,assigned:!e.assigned}:e)),j(!0))}})}),r.jsx("td",{className:"px-3 py-2",children:e.name}),r.jsx("td",{className:"px-3 py-2",children:r.jsx("input",{type:"checkbox",checked:!!e.leadProfileId&&(!t?.id||e.leadProfileId===t?.id),onChange:()=>{var s;return s=e.id,void(u(e=>e.map(e=>e.id===s?{...e,leadProfileId:e.leadProfileId?null:t?.id||"__temp__"}:e)),j(!0))}})})]},e.id)),0===h.length&&r.jsx("tr",{children:r.jsx("td",{className:"px-3 py-6 text-xs text-fg-muted",colSpan:3,children:"Keine Klassen gefunden."})})]})]})})]}),(0,r.jsxs)("div",{className:"rounded border border-neutral-900 p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("div",{className:"text-sm font-medium",children:"Sch\xfcler importieren (XLSX/CSV)"}),r.jsx(l.z,{onClick:()=>f(e=>!e),children:p?"Schlie\xdfen":"\xd6ffnen"})]}),p&&r.jsx("div",{className:"mt-2",children:r.jsx(c.ImportStudents,{})})]}),(0,r.jsxs)("div",{className:"flex justify-between gap-2",children:[!e&&t?.id&&r.jsx(l.z,{variant:"danger",onClick:async()=>{confirm("Profil und zugeh\xf6rige Pl\xe4ne wirklich l\xf6schen?")&&(await fetch(`/api/profiles/${t.id}`,{method:"DELETE"}),s(!0))},children:"Profil l\xf6schen"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(l.z,{onClick:()=>s(!!g),children:"Abbrechen"}),r.jsx(l.z,{variant:"primary",onClick:b,disabled:m||!i.trim(),children:e?"Anlegen":"Speichern"})]})]})]})]})})}function u(){let[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)([]),[i,d]=(0,a.useState)([]),[o,c]=(0,a.useState)(null),[u,m]=(0,a.useState)(""),[x,p]=(0,a.useState)(""),[f,g]=(0,a.useState)(!1),[j,b]=(0,a.useState)(!1),[v,y]=(0,a.useState)(!1),N=(0,a.useMemo)(()=>o?.name??"Profil w\xe4hlen…",[o]);return r.jsx("header",{className:"border-b border-neutral-900 bg-bg-soft/60 backdrop-blur",children:(0,r.jsxs)("div",{className:"container flex h-12 items-center justify-between gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(l.z,{"aria-label":"Sidebar umschalten",onClick:()=>{let e=!v;y(e),window.dispatchEvent(new StorageEvent("storage",{key:"sidebar",newValue:JSON.stringify({open:e})}))},children:"☰"}),(0,r.jsxs)("select",{value:o?.id||"",onChange:t=>{if("__new__"===t.target.value){b(!0),g(!0);return}c(e.find(e=>e.id===t.target.value)||null)},className:"rounded bg-neutral-900 px-2 py-1 border border-neutral-800",children:[r.jsx("option",{value:"",children:N}),e.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id)),r.jsx("option",{value:"__new__",children:"+ Profil anlegen…"})]}),(0,r.jsxs)("select",{value:u,onChange:e=>m(e.target.value),disabled:!o,className:"rounded bg-neutral-900 px-2 py-1 border border-neutral-800 disabled:opacity-50",children:[r.jsx("option",{value:"",children:"Klasse w\xe4hlen…"}),s.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]}),(0,r.jsxs)("select",{value:x,onChange:e=>p(e.target.value),className:"rounded bg-neutral-900 px-2 py-1 border border-neutral-800",children:[r.jsx("option",{value:"",children:"Raum w\xe4hlen…"}),i.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),r.jsx(l.z,{"aria-label":"Einstellungen",onClick:()=>{b(!1),g(!0)},children:"⚙️"}),f&&r.jsx(h,{createMode:j,profile:j?null:o,onClose:async e=>{if(g(!1),e){let[e,s]=await Promise.all([fetch("/api/profiles").then(e=>e.json()),fetch("/api/rooms").then(e=>e.json())]);t(e),d(s),o&&n(await fetch(`/api/classes?profileId=${o.id}`).then(e=>e.json()))}}})]})})}},5698:(e,t,s)=>{"use strict";s.d(t,{ImportStudents:()=>n});var r=s(326),a=s(7577),l=s(5603);function n(){let[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(!1),[i,d]=(0,a.useState)(null);async function o(e){n(!0),t([]),d(null);try{let t=await function(e,t={}){let{timeoutMs:s=15e3,...r}=t,a=new AbortController,l=setTimeout(()=>a.abort(),s);return fetch(e,{...r,signal:a.signal}).finally(()=>clearTimeout(l))}("/api/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rows:e}),timeoutMs:15e3});if(!t.ok){let e=await t.text().catch(()=>""),s="Import fehlgeschlagen";try{let t=e?JSON.parse(e):null;s=t?.error||s}catch{s=e||s}throw Error(s)}let s=await t.text(),r=s?JSON.parse(s):null;d(r)}catch(e){t([e?.name==="AbortError"||/aborted/i.test(String(e?.message))?"Zeit\xfcberschreitung: Server nicht erreichbar (m\xf6gliche DB-Verbindung).":e?.message??"Import fehlgeschlagen"])}finally{n(!1)}}return(0,r.jsxs)("div",{className:"grid gap-6",children:[(0,r.jsxs)("div",{className:"grid gap-2",children:[r.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:function(e){let s=e.target.files?.[0];if(!s)return;t([]),d(null);let r=new FileReader;r.onload=async()=>{let e=r.result;try{let t;if(!e)return;let s=(t="string"==typeof e?l.ij(e,{type:"string"}):l.ij(e,{type:"array"})).Sheets[t.SheetNames[0]],r=l.P6.sheet_to_json(s,{defval:""}).map(e=>({foreName:String(e.foreName??"").trim(),className:String(e["klasse.name"]??"").trim(),externalKey:String(e.externKey??"").trim()}));await o(r)}catch(e){t([e?.message||"Fehler beim Lesen der Datei"])}},s.name.toLowerCase().endsWith(".csv")?r.readAsText(s):r.readAsArrayBuffer(s)},className:"text-sm"}),r.jsx("p",{className:"text-xs text-fg-muted",children:"Erwartete Spalten (exakt): foreName, klasse.name, externKey. Der Import startet automatisch."}),s&&r.jsx("span",{className:"text-xs text-fg-muted",children:"Import l\xe4uft…"})]}),i&&r.jsx("div",{className:"rounded border border-neutral-900 bg-neutral-900/30 p-4 text-sm",children:(0,r.jsxs)("div",{className:"grid gap-1",children:[(0,r.jsxs)("div",{children:["Neu angelegte Sch\xfcler: ",r.jsx("span",{className:"text-primary",children:i.createdStudents})]}),(0,r.jsxs)("div",{children:["Aktualisierte Sch\xfcler: ",r.jsx("span",{className:"text-primary",children:i.updatedStudents})]}),(0,r.jsxs)("div",{children:["Neu angelegte Klassen: ",r.jsx("span",{className:"text-primary",children:i.createdClasses})]}),i.errors.length>0&&(0,r.jsxs)("div",{className:"mt-2 text-red-300",children:["Fehler: ",i.errors.length," – z. B. in Zeilen: ",i.errors.slice(0,5).map(e=>e.index+1).join(", "),i.errors.length>5?"…":""]})]})}),e.length>0&&r.jsx("div",{className:"rounded border border-red-900 bg-red-950/30 p-3 text-sm text-red-200",children:e.map((e,t)=>r.jsx("div",{children:e},t))})]})}},3679:(e,t,s)=>{"use strict";s.d(t,{z:()=>a});var r=s(326);function a({variant:e="ghost",className:t="",...s}){return r.jsx("button",{className:`inline-flex items-center rounded px-3 py-2 text-sm transition-colors ${{primary:"bg-primary/20 text-primary hover:bg-primary/30",ghost:"bg-neutral-800 text-fg hover:bg-neutral-700",danger:"bg-red-900/40 text-red-300 hover:bg-red-900/60"}[e]} ${t}`,...s})}s(7577)},9418:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r={modal:1e3,dropdown:950,toolbar:900,overlay:800}},5254:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c,metadata:()=>o});var r=s(9510);s(7272);var a=s(8570);let l=(0,a.createProxy)(String.raw`/Users/jz/Platzhirsch/components/Layout/TopBar.tsx`),{__esModule:n,$$typeof:i}=l;l.default;let d=(0,a.createProxy)(String.raw`/Users/jz/Platzhirsch/components/Layout/TopBar.tsx#TopBar`),o={title:"Sitzplan",description:"Sitzpl\xe4ne f\xfcr Klassen und R\xe4ume"};function c({children:e}){return r.jsx("html",{lang:"de",className:"dark",children:(0,r.jsxs)("body",{children:[r.jsx(d,{}),e]})})}},7272:()=>{}};