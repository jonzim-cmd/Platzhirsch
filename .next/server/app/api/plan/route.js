"use strict";(()=>{var e={};e.id=172,e.ids=[172],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},448:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>w,patchFetch:()=>P,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var r={};n.r(r),n.d(r,{GET:()=>u,POST:()=>p});var a=n(9303),s=n(8716),i=n(670),o=n(7070),l=n(71),d=n(3524);async function u(e){let{searchParams:t}=new URL(e.url),n=t.get("ownerProfileId")||"",r=t.get("classId")||"",a=t.get("roomId")||"",s="1"===t.get("includeLead"),i="1"===t.get("create");if(!n||!r||!a)return o.NextResponse.json({error:"missing params"},{status:400});let u=await l._.seatingPlan.findUnique({where:{ownerProfileId_classId_roomId:{ownerProfileId:n,classId:r,roomId:a}},include:{elements:!0}});if(!u&&i&&(u=await l._.seatingPlan.create({data:{ownerProfileId:n,classId:r,roomId:a,title:null,elements:{create:[{type:d.ElementType.TEACHER_DESK,x:40,y:40,w:200,h:60,rotation:0,z:0}]}},include:{elements:!0}})),!u)return o.NextResponse.json({error:"not found"},{status:404});if(!s)return o.NextResponse.json({plan:u});let p=await l._.class.findUnique({where:{id:r}}),c=null;return p?.leadProfileId&&(c=await l._.seatingPlan.findUnique({where:{ownerProfileId_classId_roomId:{ownerProfileId:p.leadProfileId,classId:r,roomId:a}},include:{elements:!0}})),o.NextResponse.json({plan:u,leadPlan:c})}async function p(e){let t=await e.json().catch(()=>null);if(!t?.planId||!Array.isArray(t?.elements))return o.NextResponse.json({error:"invalid body"},{status:400});let n=await l._.seatingPlan.findUnique({where:{id:t.planId}});return n?(await l._.$transaction([l._.seatingElement.deleteMany({where:{seatingPlanId:n.id}}),l._.seatingElement.createMany({data:t.elements.map(e=>({seatingPlanId:n.id,type:e.type,refId:e.refId??null,x:e.x??0,y:e.y??0,w:e.w??80,h:e.h??50,rotation:e.rotation??0,z:e.z??0,groupId:e.groupId??null,meta:e.meta??null}))})]),o.NextResponse.json({ok:!0})):o.NextResponse.json({error:"plan not found"},{status:404})}let c=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/plan/route",pathname:"/api/plan",filename:"route",bundlePath:"app/api/plan/route"},resolvedPagePath:"/Users/jz/Platzhirsch/app/api/plan/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:f}=c,w="/api/plan/route";function P(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},71:(e,t,n)=>{n.d(t,{_:()=>a});var r=n(3524);let a=globalThis.prisma??new r.PrismaClient({log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[948,59],()=>n(448));module.exports=r})();