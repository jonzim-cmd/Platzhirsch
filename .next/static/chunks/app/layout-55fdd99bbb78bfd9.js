(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{3717:function(e,n,t){Promise.resolve().then(t.t.bind(t,8877,23)),Promise.resolve().then(t.bind(t,7770))},7770:function(e,n,t){"use strict";t.d(n,{TopBar:function(){return c}});var a=t(7437),l=t(2265),s=t(4308);let i=l.forwardRef((e,n)=>{let{label:t,className:l="",...s}=e;return(0,a.jsxs)("label",{className:"grid gap-2 text-sm",children:[t?(0,a.jsx)("span",{className:"text-fg-muted",children:t}):null,(0,a.jsx)("input",{ref:n,className:"rounded border border-neutral-800 bg-neutral-900 px-3 py-2 outline-none ring-0 focus:border-neutral-600 "+l,...s})]})});i.displayName="Input";var r=t(4887);function d(e){let{children:n,onClose:t}=e;(0,l.useEffect)(()=>{let e=document.body.style.overflow;document.body.style.overflow="hidden";let n=e=>{"Escape"===e.key&&t()};return window.addEventListener("keydown",n),()=>{document.body.style.overflow=e,window.removeEventListener("keydown",n)}},[t]);let s=(0,a.jsxs)("div",{"aria-modal":"true",role:"dialog",className:"fixed inset-0 z-[1000]",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/60",onClick:t}),(0,a.jsx)("div",{className:"absolute inset-0 grid place-items-center p-4",children:n})]});return"undefined"==typeof document?null:(0,r.createPortal)(s,document.body)}function o(e){let{createMode:n,profile:t,onClose:r}=e,[o,c]=(0,l.useState)((null==t?void 0:t.name)||""),[u,h]=(0,l.useState)([]),[f,p]=(0,l.useState)(!1),[m,x]=(0,l.useState)(!1);async function v(){p(!0);try{let e=(null==t?void 0:t.id)||"";for(let a of(n?e=(await fetch("/api/profiles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o})}).then(e=>e.json())).id:o!==(null==t?void 0:t.name)&&await fetch("/api/profiles/".concat(null==t?void 0:t.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o})}),u)){let n=!!a.assigned;await fetch("/api/profile-classes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileId:e,classId:a.id,assigned:n})})}for(let n of u){let t=n.leadProfileId===e;await fetch("/api/class/lead",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:n.id,leadProfileId:t?e:null})})}x(!0),r(!0)}finally{p(!1)}}return(0,l.useEffect)(()=>{let e=null==t?void 0:t.id;!n&&e?fetch("/api/profile-classes?profileId=".concat(e)).then(e=>e.json()).then(h):fetch("/api/profile-classes?profileId=__none__").then(e=>e.json()).then(e=>{Array.isArray(e)&&h(e.map(e=>{var n;return{...e,assigned:!1,leadProfileId:null!==(n=e.leadProfileId)&&void 0!==n?n:null}}))}).catch(async()=>{h((await fetch("/api/classes").then(e=>e.json())).map(e=>{var n;return{id:e.id,name:e.name,assigned:!1,leadProfileId:null!==(n=e.leadProfileId)&&void 0!==n?n:null}}))})},[null==t?void 0:t.id,n]),(0,a.jsx)(d,{onClose:()=>r(!1),children:(0,a.jsxs)("div",{className:"w-[min(90vw,800px)] rounded border border-neutral-800 bg-bg-soft p-4 shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-lg font-medium",children:n?"Profil anlegen":"Profil bearbeiten"}),(0,a.jsx)("button",{className:"text-fg-muted hover:text-fg",onClick:()=>r(!!m),children:"✕"})]}),(0,a.jsxs)("div",{className:"mt-4 grid gap-4",children:[(0,a.jsx)(i,{label:"Name",value:o,onChange:e=>c(e.target.value),placeholder:"z. B. Frau M\xfcller"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-2 text-sm font-medium",children:"Klassen (Zuweisung + Klassenleitung)"}),(0,a.jsx)("div",{className:"max-h-[40vh] overflow-auto rounded border border-neutral-900",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-neutral-900/50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Zugewiesen"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Klasse"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"KL"})]})}),(0,a.jsxs)("tbody",{children:[u.map(e=>(0,a.jsxs)("tr",{className:"border-t border-neutral-900",children:[(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsx)("input",{type:"checkbox",checked:e.assigned,onChange:()=>{var n;return n=e.id,void(h(e=>e.map(e=>e.id===n?{...e,assigned:!e.assigned}:e)),x(!0))}})}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.name}),(0,a.jsx)("td",{className:"px-3 py-2",children:(0,a.jsx)("input",{type:"checkbox",checked:!!e.leadProfileId&&(!(null==t?void 0:t.id)||e.leadProfileId===(null==t?void 0:t.id)),onChange:()=>{var n;return n=e.id,void(h(e=>e.map(e=>e.id===n?{...e,leadProfileId:e.leadProfileId?null:(null==t?void 0:t.id)||"__temp__"}:e)),x(!0))}})})]},e.id)),0===u.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{className:"px-3 py-6 text-xs text-fg-muted",colSpan:3,children:"Keine Klassen gefunden."})})]})]})})]}),(0,a.jsxs)("div",{className:"flex justify-between gap-2",children:[!n&&(null==t?void 0:t.id)&&(0,a.jsx)(s.z,{variant:"danger",onClick:async()=>{confirm("Profil und zugeh\xf6rige Pl\xe4ne wirklich l\xf6schen?")&&(await fetch("/api/profiles/".concat(t.id),{method:"DELETE"}),r(!0))},children:"Profil l\xf6schen"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(s.z,{onClick:()=>r(!!m),children:"Abbrechen"}),(0,a.jsx)(s.z,{variant:"primary",onClick:v,disabled:f||!o.trim(),children:n?"Anlegen":"Speichern"})]})]})]})]})})}function c(){let[e,n]=(0,l.useState)([]),[t,i]=(0,l.useState)([]),[r,d]=(0,l.useState)([]),[c,u]=(0,l.useState)(null),[h,f]=(0,l.useState)(""),[p,m]=(0,l.useState)(""),[x,v]=(0,l.useState)(!1),[g,b]=(0,l.useState)(!1),[j,y]=(0,l.useState)(!1);function w(e,n,t){let a=new URL(window.location.href);a.searchParams.delete("p"),a.searchParams.delete("c"),a.searchParams.delete("r"),e&&a.searchParams.set("p",e),n&&a.searchParams.set("c",n),t&&a.searchParams.set("r",t),window.history.replaceState({},"",a.toString()),window.dispatchEvent(new StorageEvent("storage",{key:"selection",newValue:JSON.stringify({p:e,c:n,r:t})}))}(0,l.useEffect)(()=>{fetch("/api/profiles").then(e=>e.json()).then(n).catch(()=>{}),fetch("/api/rooms").then(e=>e.json()).then(d).catch(()=>{});try{let n=new URL(window.location.href),t=n.searchParams.get("p"),a=n.searchParams.get("c"),l=n.searchParams.get("r"),s=localStorage.getItem("activeProfile");if(t&&e.length){let n=e.find(e=>e.id===t)||null;u(n),n&&localStorage.setItem("activeProfile",JSON.stringify(n))}else s&&u(JSON.parse(s));a&&f(a),l&&m(l)}catch(e){}},[]),(0,l.useEffect)(()=>{if(!c){i([]),w(void 0,void 0,void 0);return}fetch("/api/classes?profileId=".concat(c.id)).then(e=>e.json()).then(e=>{i(e),-1===e.findIndex(e=>e.id===h)&&f("")}),localStorage.setItem("activeProfile",JSON.stringify(c)),w(c.id,h||void 0,p||void 0)},[null==c?void 0:c.id]),(0,l.useEffect)(()=>{w(null==c?void 0:c.id,h||void 0,p||void 0)},[h,p]);let N=(0,l.useMemo)(()=>{var e;return null!==(e=null==c?void 0:c.name)&&void 0!==e?e:"Profil w\xe4hlen…"},[c]);return(0,a.jsx)("header",{className:"border-b border-neutral-900 bg-bg-soft/60 backdrop-blur",children:(0,a.jsxs)("div",{className:"container flex h-12 items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(s.z,{"aria-label":"Sidebar umschalten",onClick:()=>{let e=!j;y(e),window.dispatchEvent(new StorageEvent("storage",{key:"sidebar",newValue:JSON.stringify({open:e})}))},children:"☰"}),(0,a.jsxs)("select",{value:(null==c?void 0:c.id)||"",onChange:n=>{if("__new__"===n.target.value){b(!0),v(!0);return}u(e.find(e=>e.id===n.target.value)||null)},className:"rounded bg-neutral-900 px-2 py-1 border border-neutral-800",children:[(0,a.jsx)("option",{value:"",children:N}),e.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id)),(0,a.jsx)("option",{value:"__new__",children:"+ Profil anlegen…"})]}),(0,a.jsxs)("select",{value:h,onChange:e=>f(e.target.value),disabled:!c,className:"rounded bg-neutral-900 px-2 py-1 border border-neutral-800 disabled:opacity-50",children:[(0,a.jsx)("option",{value:"",children:"Klasse w\xe4hlen…"}),t.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsxs)("select",{value:p,onChange:e=>m(e.target.value),className:"rounded bg-neutral-900 px-2 py-1 border border-neutral-800",children:[(0,a.jsx)("option",{value:"",children:"Raum w\xe4hlen…"}),r.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsx)(s.z,{"aria-label":"Einstellungen",onClick:()=>{b(!1),v(!0)},children:"⚙️"}),x&&(0,a.jsx)(o,{createMode:g,profile:g?null:c,onClose:async e=>{if(v(!1),e){let[e,t]=await Promise.all([fetch("/api/profiles").then(e=>e.json()),fetch("/api/rooms").then(e=>e.json())]);n(e),d(t),c&&i(await fetch("/api/classes?profileId=".concat(c.id)).then(e=>e.json()))}}})]})})}},4308:function(e,n,t){"use strict";t.d(n,{z:function(){return l}});var a=t(7437);function l(e){let{variant:n="ghost",className:t="",...l}=e;return(0,a.jsx)("button",{className:"".concat("inline-flex items-center rounded px-3 py-2 text-sm transition-colors"," ").concat({primary:"bg-primary/20 text-primary hover:bg-primary/30",ghost:"bg-neutral-800 text-fg hover:bg-neutral-700",danger:"bg-red-900/40 text-red-300 hover:bg-red-900/60"}[n]," ").concat(t),...l})}t(2265)},8877:function(){}},function(e){e.O(0,[404,971,23,744],function(){return e(e.s=3717)}),_N_E=e.O()}]);