(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{3717:function(e,a,t){Promise.resolve().then(t.t.bind(t,8877,23)),Promise.resolve().then(t.bind(t,9483))},9483:function(e,a,t){"use strict";t.d(a,{TopBar:function(){return d}});var n=t(7437),l=t(2265),s=t(4308);let i=l.forwardRef((e,a)=>{let{label:t,className:l="",...s}=e;return(0,n.jsxs)("label",{className:"grid gap-2 text-sm",children:[t?(0,n.jsx)("span",{className:"text-fg-muted",children:t}):null,(0,n.jsx)("input",{ref:a,className:"rounded border border-neutral-800 bg-neutral-900 px-3 py-2 outline-none ring-0 focus:border-neutral-600 "+l,...s})]})});function r(e){let{createMode:a,profile:t,onClose:r}=e,[d,o]=(0,l.useState)((null==t?void 0:t.name)||""),[c,u]=(0,l.useState)([]),[h,f]=(0,l.useState)(!1),[p,m]=(0,l.useState)(!1);async function x(){f(!0);try{let e=(null==t?void 0:t.id)||"";for(let n of(a?e=(await fetch("/api/profiles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:d})}).then(e=>e.json())).id:d!==(null==t?void 0:t.name)&&await fetch("/api/profiles/".concat(null==t?void 0:t.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:d})}),c)){let a=!!n.assigned;await fetch("/api/profile-classes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileId:e,classId:n.id,assigned:a})})}for(let a of c){let t=a.leadProfileId===e;await fetch("/api/class/lead",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classId:a.id,leadProfileId:t?e:null})})}m(!0),r(!0)}finally{f(!1)}}return(0,l.useEffect)(()=>{let e=null==t?void 0:t.id;!a&&e?fetch("/api/profile-classes?profileId=".concat(e)).then(e=>e.json()).then(u):fetch("/api/profile-classes?profileId=__none__").then(e=>e.json()).then(e=>{Array.isArray(e)&&u(e.map(e=>{var a;return{...e,assigned:!1,leadProfileId:null!==(a=e.leadProfileId)&&void 0!==a?a:null}}))}).catch(async()=>{u((await fetch("/api/classes").then(e=>e.json())).map(e=>{var a;return{id:e.id,name:e.name,assigned:!1,leadProfileId:null!==(a=e.leadProfileId)&&void 0!==a?a:null}}))})},[null==t?void 0:t.id,a]),(0,n.jsx)("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/60",children:(0,n.jsxs)("div",{className:"w-[min(90vw,800px)] rounded border border-neutral-800 bg-bg-soft p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"text-lg font-medium",children:a?"Profil anlegen":"Profil bearbeiten"}),(0,n.jsx)("button",{className:"text-fg-muted hover:text-fg",onClick:()=>r(!!p),children:"✕"})]}),(0,n.jsxs)("div",{className:"mt-4 grid gap-4",children:[(0,n.jsx)(i,{label:"Name",value:d,onChange:e=>o(e.target.value),placeholder:"z. B. Frau M\xfcller"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"mb-2 text-sm font-medium",children:"Klassen (Zuweisung + Klassenleitung)"}),(0,n.jsx)("div",{className:"max-h-[40vh] overflow-auto rounded border border-neutral-900",children:(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{className:"bg-neutral-900/50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-3 py-2 text-left",children:"Zugewiesen"}),(0,n.jsx)("th",{className:"px-3 py-2 text-left",children:"Klasse"}),(0,n.jsx)("th",{className:"px-3 py-2 text-left",children:"KL"})]})}),(0,n.jsxs)("tbody",{children:[c.map(e=>(0,n.jsxs)("tr",{className:"border-t border-neutral-900",children:[(0,n.jsx)("td",{className:"px-3 py-2",children:(0,n.jsx)("input",{type:"checkbox",checked:e.assigned,onChange:()=>{var a;return a=e.id,void(u(e=>e.map(e=>e.id===a?{...e,assigned:!e.assigned}:e)),m(!0))}})}),(0,n.jsx)("td",{className:"px-3 py-2",children:e.name}),(0,n.jsx)("td",{className:"px-3 py-2",children:(0,n.jsx)("input",{type:"checkbox",checked:!!e.leadProfileId&&(!(null==t?void 0:t.id)||e.leadProfileId===(null==t?void 0:t.id)),onChange:()=>{var a;return a=e.id,void(u(e=>e.map(e=>e.id===a?{...e,leadProfileId:e.leadProfileId?null:(null==t?void 0:t.id)||"__temp__"}:e)),m(!0))}})})]},e.id)),0===c.length&&(0,n.jsx)("tr",{children:(0,n.jsx)("td",{className:"px-3 py-6 text-xs text-fg-muted",colSpan:3,children:"Keine Klassen gefunden."})})]})]})})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(s.z,{onClick:()=>r(!!p),children:"Abbrechen"}),(0,n.jsx)(s.z,{variant:"primary",onClick:x,disabled:h||!d.trim(),children:a?"Anlegen":"Speichern"})]})]})]})})}function d(){let[e,a]=(0,l.useState)([]),[t,i]=(0,l.useState)([]),[d,o]=(0,l.useState)([]),[c,u]=(0,l.useState)(null),[h,f]=(0,l.useState)(""),[p,m]=(0,l.useState)(""),[x,g]=(0,l.useState)(!1),[v,b]=(0,l.useState)(!1);function j(e,a,t){let n=new URL(window.location.href);n.searchParams.delete("p"),n.searchParams.delete("c"),n.searchParams.delete("r"),e&&n.searchParams.set("p",e),a&&n.searchParams.set("c",a),t&&n.searchParams.set("r",t),window.history.replaceState({},"",n.toString()),window.dispatchEvent(new StorageEvent("storage",{key:"selection",newValue:JSON.stringify({p:e,c:a,r:t})}))}(0,l.useEffect)(()=>{fetch("/api/profiles").then(e=>e.json()).then(a).catch(()=>{}),fetch("/api/rooms").then(e=>e.json()).then(o).catch(()=>{});try{let a=new URL(window.location.href),t=a.searchParams.get("p"),n=a.searchParams.get("c"),l=a.searchParams.get("r"),s=localStorage.getItem("activeProfile");if(t&&e.length){let a=e.find(e=>e.id===t)||null;u(a),a&&localStorage.setItem("activeProfile",JSON.stringify(a))}else s&&u(JSON.parse(s));n&&f(n),l&&m(l)}catch(e){}},[]),(0,l.useEffect)(()=>{if(!c){i([]),j(void 0,void 0,void 0);return}fetch("/api/classes?profileId=".concat(c.id)).then(e=>e.json()).then(e=>{i(e),-1===e.findIndex(e=>e.id===h)&&f("")}),localStorage.setItem("activeProfile",JSON.stringify(c)),j(c.id,h||void 0,p||void 0)},[null==c?void 0:c.id]),(0,l.useEffect)(()=>{j(null==c?void 0:c.id,h||void 0,p||void 0)},[h,p]);let y=(0,l.useMemo)(()=>{var e;return null!==(e=null==c?void 0:c.name)&&void 0!==e?e:"Profil w\xe4hlen…"},[c]);return(0,n.jsx)("header",{className:"border-b border-neutral-900 bg-bg-soft/60 backdrop-blur",children:(0,n.jsxs)("div",{className:"container flex h-12 items-center gap-3",children:[(0,n.jsxs)("select",{value:(null==c?void 0:c.id)||"",onChange:a=>{if("__new__"===a.target.value){b(!0),g(!0);return}u(e.find(e=>e.id===a.target.value)||null)},className:"rounded bg-neutral-900 px-2 py-1 border border-neutral-800",children:[(0,n.jsx)("option",{value:"",children:y}),e.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id)),(0,n.jsx)("option",{value:"__new__",children:"+ Profil anlegen…"})]}),(0,n.jsxs)("select",{value:h,onChange:e=>f(e.target.value),disabled:!c,className:"rounded bg-neutral-900 px-2 py-1 border border-neutral-800 disabled:opacity-50",children:[(0,n.jsx)("option",{value:"",children:"Klasse w\xe4hlen…"}),t.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,n.jsxs)("select",{value:p,onChange:e=>m(e.target.value),className:"rounded bg-neutral-900 px-2 py-1 border border-neutral-800",children:[(0,n.jsx)("option",{value:"",children:"Raum w\xe4hlen…"}),d.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,n.jsx)(s.z,{"aria-label":"Einstellungen",onClick:()=>{b(!1),g(!0)},children:"⚙️"}),x&&(0,n.jsx)(r,{createMode:v,profile:v?null:c,onClose:async e=>{if(g(!1),e){let[e,t]=await Promise.all([fetch("/api/profiles").then(e=>e.json()),fetch("/api/rooms").then(e=>e.json())]);a(e),o(t),c&&i(await fetch("/api/classes?profileId=".concat(c.id)).then(e=>e.json()))}}})]})})}i.displayName="Input"},4308:function(e,a,t){"use strict";t.d(a,{z:function(){return l}});var n=t(7437);function l(e){let{variant:a="ghost",className:t="",...l}=e;return(0,n.jsx)("button",{className:"".concat("inline-flex items-center rounded px-3 py-2 text-sm transition-colors"," ").concat({primary:"bg-primary/20 text-primary hover:bg-primary/30",ghost:"bg-neutral-800 text-fg hover:bg-neutral-700",danger:"bg-red-900/40 text-red-300 hover:bg-red-900/60"}[a]," ").concat(t),...l})}t(2265)},8877:function(){}},function(e){e.O(0,[404,971,23,744],function(){return e(e.s=3717)}),_N_E=e.O()}]);