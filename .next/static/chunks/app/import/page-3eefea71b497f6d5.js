(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[649],{67:function(){},2061:function(){},8496:function(e,t,r){Promise.resolve().then(r.bind(r,2772))},2772:function(e,t,r){"use strict";r.d(t,{ImportStudents:function(){return c}});var s=r(7437),a=r(2265),l=r(7800),n=r(4308);r(4590);var i=(0,r(8064).$)("b383acc2ab89d8ac8d901f4db6ddae3de2b11f86");let d=[{key:"foreName",label:"foreName"},{key:"className",label:"klasse.name"},{key:"externalKey",label:"externKey"}];function c(){let[e,t]=(0,a.useState)([]),[r,c]=(0,a.useState)([]),[o,m]=(0,a.useState)({}),[u,x]=(0,a.useState)([]),[h,p]=(0,a.useState)([]),[g,f]=(0,a.useState)(!1),[j,N]=(0,a.useState)(null),v=r.length>0,y=(0,a.useMemo)(()=>d.every(e=>o[e.key]),[o]);async function b(){f(!0),p([]),N(null);try{let e=await i({rows:u});N(e)}catch(t){var e;p([null!==(e=null==t?void 0:t.message)&&void 0!==e?e:"Import fehlgeschlagen"])}finally{f(!1)}}return(0,s.jsxs)("div",{className:"grid gap-6",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:function(e){var r;let s=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!s)return;p([]),N(null);let a=new FileReader;a.onload=()=>{let e=a.result;try{let r;if(!e)return;let s=(r="string"==typeof e?l.ij(e,{type:"string"}):l.ij(e,{type:"array"})).Sheets[r.SheetNames[0]],a=l.P6.sheet_to_json(s,{defval:""});t(a);let n=Object.keys(a[0]||{});c(n);let i={};d.forEach(e=>{let t=n.find(t=>t.trim().toLowerCase()===e.label.toLowerCase());t&&(i[e.key]=t)}),m(i)}catch(e){p([(null==e?void 0:e.message)||"Fehler beim Lesen der Datei"])}},s.name.toLowerCase().endsWith(".csv")?a.readAsText(s):a.readAsArrayBuffer(s)},className:"text-sm"}),(0,s.jsx)("p",{className:"text-xs text-fg-muted",children:"Erwartete Spalten: foreName, klasse.name, externKey"})]}),v&&(0,s.jsxs)("div",{className:"grid gap-3",children:[(0,s.jsx)("h3",{className:"text-sm font-medium",children:"Spalten zuordnen"}),(0,s.jsx)("div",{className:"grid gap-2 md:grid-cols-3",children:d.map(e=>(0,s.jsxs)("label",{className:"text-sm text-fg-muted grid gap-1",children:[(0,s.jsx)("span",{children:e.label}),(0,s.jsxs)("select",{className:"rounded bg-neutral-900 px-2 py-2 border border-neutral-800",value:o[e.key]||"",onChange:t=>m(r=>({...r,[e.key]:t.target.value})),children:[(0,s.jsx)("option",{value:"",children:"– w\xe4hlen –"}),r.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]},e.key))}),(0,s.jsx)("div",{children:(0,s.jsx)(n.z,{onClick:function(){y&&x(e.map(e=>{var t,r,s;return{foreName:String(null!==(t=e[o.foreName])&&void 0!==t?t:"").trim(),className:String(null!==(r=e[o.className])&&void 0!==r?r:"").trim(),externalKey:String(null!==(s=e[o.externalKey])&&void 0!==s?s:"").trim()}}))},disabled:!y,children:"Vorschau erstellen"})})]}),u.length>0&&(0,s.jsxs)("div",{className:"grid gap-3",children:[(0,s.jsxs)("h3",{className:"text-sm font-medium",children:["Vorschau (",u.length," Zeilen)"]}),(0,s.jsx)("div",{className:"overflow-auto rounded border border-neutral-900",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-neutral-900/50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"foreName"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"klasse.name"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"externKey"})]})}),(0,s.jsx)("tbody",{children:u.slice(0,200).map((e,t)=>(0,s.jsxs)("tr",{className:"border-t border-neutral-900",children:[(0,s.jsx)("td",{className:"px-3 py-2",children:e.foreName}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.className}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.externalKey})]},t))})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(n.z,{onClick:b,variant:"primary",disabled:g,children:"Importieren"}),g&&(0,s.jsx)("span",{className:"text-xs text-fg-muted",children:"Import l\xe4uft…"})]})]}),j&&(0,s.jsx)("div",{className:"rounded border border-neutral-900 bg-neutral-900/30 p-4 text-sm",children:(0,s.jsxs)("div",{className:"grid gap-1",children:[(0,s.jsxs)("div",{children:["Neu angelegte Sch\xfcler: ",(0,s.jsx)("span",{className:"text-primary",children:j.createdStudents})]}),(0,s.jsxs)("div",{children:["Aktualisierte Sch\xfcler: ",(0,s.jsx)("span",{className:"text-primary",children:j.updatedStudents})]}),(0,s.jsxs)("div",{children:["Neu angelegte Klassen: ",(0,s.jsx)("span",{className:"text-primary",children:j.createdClasses})]}),j.errors.length>0&&(0,s.jsxs)("div",{className:"mt-2 text-red-300",children:["Fehler: ",j.errors.length," – z. B. in Zeilen: ",j.errors.slice(0,5).map(e=>e.index+1).join(", "),j.errors.length>5?"…":""]})]})}),h.length>0&&(0,s.jsx)("div",{className:"rounded border border-red-900 bg-red-950/30 p-3 text-sm text-red-200",children:h.map((e,t)=>(0,s.jsx)("div",{children:e},t))})]})}},4308:function(e,t,r){"use strict";r.d(t,{z:function(){return a}});var s=r(7437);function a(e){let{variant:t="ghost",className:r="",...a}=e;return(0,s.jsx)("button",{className:"".concat("inline-flex items-center rounded px-3 py-2 text-sm transition-colors"," ").concat({primary:"bg-primary/20 text-primary hover:bg-primary/30",ghost:"bg-neutral-800 text-fg hover:bg-neutral-700",danger:"bg-red-900/40 text-red-300 hover:bg-red-900/60"}[t]," ").concat(r),...a})}r(2265)},8064:function(e,t,r){"use strict";Object.defineProperty(t,"$",{enumerable:!0,get:function(){return a}});let s=r(4590);function a(e){let{createServerReference:t}=r(6671);return t(e,s.callServer)}}},function(e){e.O(0,[425,971,23,744],function(){return e(e.s=8496)}),_N_E=e.O()}]);