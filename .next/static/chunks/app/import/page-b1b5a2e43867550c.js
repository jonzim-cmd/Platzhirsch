(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[649],{67:function(){},2061:function(){},8496:function(e,t,r){Promise.resolve().then(r.bind(r,3195))},3195:function(e,t,r){"use strict";r.d(t,{ImportStudents:function(){return l}});var n=r(7437),s=r(2265),a=r(7800);function l(){let[e,t]=(0,s.useState)([]),[r,l]=(0,s.useState)(!1),[i,d]=(0,s.useState)(null);async function o(e){l(!0),t([]),d(null);try{let t=await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{timeoutMs:r=15e3,...n}=t,s=new AbortController,a=setTimeout(()=>s.abort(),r);return fetch(e,{...n,signal:s.signal}).finally(()=>clearTimeout(a))}("/api/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rows:e}),timeoutMs:15e3});if(!t.ok){let e=await t.text().catch(()=>""),r="Import fehlgeschlagen";try{let t=e?JSON.parse(e):null;r=(null==t?void 0:t.error)||r}catch(t){r=e||r}throw Error(r)}let r=await t.text(),n=r?JSON.parse(r):null;d(n)}catch(e){var r;t([(null==e?void 0:e.name)==="AbortError"||/aborted/i.test(String(null==e?void 0:e.message))?"Zeit\xfcberschreitung: Server nicht erreichbar (m\xf6gliche DB-Verbindung).":null!==(r=null==e?void 0:e.message)&&void 0!==r?r:"Import fehlgeschlagen"])}finally{l(!1)}}return(0,n.jsxs)("div",{className:"grid gap-6",children:[(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:function(e){var r;let n=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!n)return;t([]),d(null);let s=new FileReader;s.onload=async()=>{let e=s.result;try{let t;if(!e)return;let r=(t="string"==typeof e?a.ij(e,{type:"string"}):a.ij(e,{type:"array"})).Sheets[t.SheetNames[0]],n=a.P6.sheet_to_json(r,{defval:""}).map(e=>{var t,r,n;return{foreName:String(null!==(t=e.foreName)&&void 0!==t?t:"").trim(),className:String(null!==(r=e["klasse.name"])&&void 0!==r?r:"").trim(),externalKey:String(null!==(n=e.externKey)&&void 0!==n?n:"").trim()}});await o(n)}catch(e){t([(null==e?void 0:e.message)||"Fehler beim Lesen der Datei"])}},n.name.toLowerCase().endsWith(".csv")?s.readAsText(n):s.readAsArrayBuffer(n)},className:"text-sm"}),(0,n.jsx)("p",{className:"text-xs text-fg-muted",children:"Erwartete Spalten (exakt): foreName, klasse.name, externKey. Der Import startet automatisch."}),r&&(0,n.jsx)("span",{className:"text-xs text-fg-muted",children:"Import l\xe4uft…"})]}),i&&(0,n.jsx)("div",{className:"rounded border border-neutral-900 bg-neutral-900/30 p-4 text-sm",children:(0,n.jsxs)("div",{className:"grid gap-1",children:[(0,n.jsxs)("div",{children:["Neu angelegte Sch\xfcler: ",(0,n.jsx)("span",{className:"text-primary",children:i.createdStudents})]}),(0,n.jsxs)("div",{children:["Aktualisierte Sch\xfcler: ",(0,n.jsx)("span",{className:"text-primary",children:i.updatedStudents})]}),(0,n.jsxs)("div",{children:["Neu angelegte Klassen: ",(0,n.jsx)("span",{className:"text-primary",children:i.createdClasses})]}),i.errors.length>0&&(0,n.jsxs)("div",{className:"mt-2 text-red-300",children:["Fehler: ",i.errors.length," – z. B. in Zeilen: ",i.errors.slice(0,5).map(e=>e.index+1).join(", "),i.errors.length>5?"…":""]})]})}),e.length>0&&(0,n.jsx)("div",{className:"rounded border border-red-900 bg-red-950/30 p-3 text-sm text-red-200",children:e.map((e,t)=>(0,n.jsx)("div",{children:e},t))})]})}}},function(e){e.O(0,[425,971,23,744],function(){return e(e.s=8496)}),_N_E=e.O()}]);