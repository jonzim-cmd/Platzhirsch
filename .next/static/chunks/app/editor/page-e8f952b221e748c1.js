(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{9859:function(e,t,r){Promise.resolve().then(r.bind(r,9001))},9001:function(e,t,r){"use strict";r.d(t,{Editor:function(){return c}});var n=r(7437),l=r(2265),a=r(2932),s=r(4308);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";return"".concat(e,"_").concat(Math.random().toString(36).slice(2,9))}function d(e,t){let r={left:e.x,top:e.y,right:e.x+e.w,bottom:e.y+e.h},n={left:t.x,top:t.y,right:t.x+t.w,bottom:t.y+t.h};return!(r.right<n.left||r.left>n.right||r.bottom<n.top||r.top>n.bottom)}function c(e){let{classes:t,rooms:r}=e,[c,o]=(0,l.useState)(null),[u,h]=(0,l.useState)(""),[m,x]=(0,l.useState)(""),[p,g]=(0,l.useState)(null),[f,b]=(0,l.useState)([]),[v,j]=(0,l.useState)([]),[N,y]=(0,l.useState)(null),[w,S]=(0,l.useState)("idle"),E=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=()=>{try{let e=localStorage.getItem("activeProfile");o(e?JSON.parse(e):null)}catch(e){o(null)}};e();let t=()=>e();return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)},[]),(0,l.useEffect)(()=>{if(!u){j([]);return}fetch("/api/students?classId=".concat(u)).then(e=>e.json()).then(e=>{Array.isArray(e)&&j(e)}).catch(()=>j([]))},[u]);let I=(0,l.useCallback)(async e=>{if(!(null==c?void 0:c.id)||!u||!m)return;let t=await fetch("/api/plan?ownerProfileId=".concat(c.id,"&classId=").concat(u,"&roomId=").concat(m,"&create=").concat(e?"1":"0"));if(!t.ok)return;let r=await t.json();g(r),b(r.elements.map(e=>({...e}))),y(null)},[null==c?void 0:c.id,u,m]),D=(0,l.useCallback)(()=>{p&&(E.current&&clearTimeout(E.current),S("saving"),E.current=setTimeout(async()=>{try{await fetch("/api/plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:p.id,elements:f})}),S("saved"),setTimeout(()=>S("idle"),1200)}catch(e){S("idle")}},900))},[p,f]),C=(0,l.useMemo)(()=>f.find(e=>e.id===N),[f,N]),R=(e,t,r)=>{b(n=>{let l=n.find(t=>t.id===e);if(!l)return n;let a=new Set((l.groupId?n.filter(e=>e.groupId===l.groupId):[l]).map(e=>e.id));return n.map(e=>a.has(e.id)?{...e,x:e.x+t,y:e.y+r}:e)})},k=e=>{b(t=>{let r=t.find(t=>t.id===e);if(!r)return t;let n=r.groupId||null;for(let l of t)if(l.id!==e&&d(r,l)){n=n||l.groupId||i("grp");break}return n?t.map(t=>t.id===e||d(r,t)?{...t,groupId:n}:t):t.map(t=>t.id===e?{...t,groupId:null}:t)}),D()},z=(e,t)=>{let r={id:i("el"),type:e,refId:null!=t?t:null,x:120,y:120,w:80,h:50,rotation:0,z:f.length,groupId:null};("WINDOW_SIDE"===e||"WALL_SIDE"===e)&&(r.w=240,r.h=8),"DOOR"===e&&(r.w=36,r.h=8),"TEACHER_DESK"===e&&(r.w=200,r.h=60),b(e=>[...e,r]),D()},[T,_]=(0,l.useState)({w:1200,h:700}),O=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=O.current;if(!e)return;let t=new ResizeObserver(()=>{let t=e.getBoundingClientRect();_({w:Math.max(600,t.width),h:Math.max(400,t.height)})});return t.observe(e),()=>t.disconnect()},[]),(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-5",children:[(0,n.jsxs)("div",{className:"lg:col-span-4 min-h-[60vh] rounded border border-neutral-900 bg-neutral-950/40",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-neutral-900 px-3 py-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-fg-muted",children:"Klasse"}),(0,n.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"rounded bg-neutral-900 px-2 py-1 border border-neutral-800",children:[(0,n.jsx)("option",{value:"",children:"– w\xe4hlen –"}),t.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-fg-muted",children:"Raum"}),(0,n.jsxs)("select",{value:m,onChange:e=>x(e.target.value),className:"rounded bg-neutral-900 px-2 py-1 border border-neutral-800",children:[(0,n.jsx)("option",{value:"",children:"– w\xe4hlen –"}),r.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsx)(s.z,{onClick:()=>I(!0),variant:"primary",disabled:!c||!u||!m,children:"Plan laden/erstellen"})]}),(0,n.jsxs)("div",{className:"text-xs text-fg-muted",children:[c?"Profil: ".concat(c.name):"Kein aktives Profil gew\xe4hlt","saving"===w&&(0,n.jsx)("span",{className:"ml-3",children:"Speichern…"}),"saved"===w&&(0,n.jsx)("span",{className:"ml-3 text-primary",children:"Gespeichert"})]})]}),(0,n.jsx)("div",{ref:O,className:"relative h-[70vh] w-full overflow-auto",children:(0,n.jsx)("div",{className:"relative",style:{width:T.w,height:T.h},children:f.map(e=>(0,n.jsxs)("div",{role:"button",onClick:()=>y(e.id),className:"absolute select-none ".concat(N===e.id?"ring-2 ring-primary/60":""),style:{left:e.x,top:e.y,width:e.w,height:e.h,transform:"rotate(".concat(e.rotation,"deg)"),zIndex:e.z},children:[(0,n.jsxs)("div",{className:"h-full w-full rounded border border-neutral-700 bg-neutral-800/60 flex items-center justify-center text-xs",children:["STUDENT"===e.type&&(0,n.jsxs)("span",{children:["Sch\xfcler",e.refId?"":" (leer)"]}),"TEACHER_DESK"===e.type&&(0,n.jsx)("span",{children:"Lehrerpult"}),"DOOR"===e.type&&(0,n.jsx)("span",{children:"T\xfcr"}),"WINDOW_SIDE"===e.type&&(0,n.jsx)("span",{children:"Fensterseite"}),"WALL_SIDE"===e.type&&(0,n.jsx)("span",{children:"Wandseite"})]}),N===e.id&&(0,n.jsx)(a.ZP,{target:()=>document.querySelector("[data-el='".concat(e.id,"']")),draggable:!0,resizable:!0,rotatable:!0,throttleDrag:0,throttleResize:0,throttleRotate:0,snappable:!0,snapThreshold:10,elementGuidelines:[],bounds:{left:0,top:0,right:T.w,bottom:T.h},onDrag:t=>{let r=t.beforeDelta[0],n=t.beforeDelta[1];R(e.id,r,n)},onDragEnd:()=>k(e.id),onResize:t=>{b(r=>r.map(r=>r.id===e.id?{...r,w:Math.max(10,t.width),h:Math.max(10,t.height),x:r.x+t.delta[0],y:r.y+t.delta[1]}:r))},onResizeEnd:()=>D(),onRotate:t=>{b(r=>r.map(r=>r.id===e.id?{...r,rotation:t.beforeRotate}:r))},onRotateEnd:()=>D()})]},e.id))})})]}),(0,n.jsxs)("aside",{className:"lg:col-span-1 grid content-start gap-4",children:[(0,n.jsxs)("div",{className:"rounded border border-neutral-900 p-3",children:[(0,n.jsx)("div",{className:"text-sm font-medium mb-2",children:"Palette"}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,n.jsx)(s.z,{onClick:()=>z("TEACHER_DESK"),children:"Lehrerpult"}),(0,n.jsx)(s.z,{onClick:()=>z("DOOR"),children:"T\xfcr"}),(0,n.jsx)(s.z,{onClick:()=>z("WINDOW_SIDE"),children:"Fensterseite"}),(0,n.jsx)(s.z,{onClick:()=>z("WALL_SIDE"),children:"Wandseite"})]})]}),(0,n.jsxs)("div",{className:"rounded border border-neutral-900 p-3",children:[(0,n.jsx)("div",{className:"text-sm font-medium mb-2",children:"Sch\xfcler hinzuf\xfcgen"}),(0,n.jsxs)("div",{className:"grid gap-2 max-h-[260px] overflow-auto",children:[v.map(e=>(0,n.jsx)(s.z,{onClick:()=>z("STUDENT",e.id),className:"justify-start",children:e.foreName},e.id)),0===v.length&&(0,n.jsx)("div",{className:"text-xs text-fg-muted",children:"Keine Sch\xfcler geladen."})]})]}),(0,n.jsxs)("div",{className:"rounded border border-neutral-900 p-3 grid gap-2",children:[(0,n.jsx)("div",{className:"text-sm font-medium",children:"Auswahl"}),!C&&(0,n.jsx)("div",{className:"text-xs text-fg-muted",children:"Nichts ausgew\xe4hlt"}),C&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"text-xs text-fg-muted",children:["Typ: ",C.type]}),(0,n.jsx)("div",{className:"flex gap-2",children:(0,n.jsx)(s.z,{onClick:()=>{N&&(b(e=>e.filter(e=>e.id!==N)),y(null),D())},variant:"danger",children:"L\xf6schen"})})]})]})]})]})}},4308:function(e,t,r){"use strict";r.d(t,{z:function(){return l}});var n=r(7437);function l(e){let{variant:t="ghost",className:r="",...l}=e;return(0,n.jsx)("button",{className:"".concat("inline-flex items-center rounded px-3 py-2 text-sm transition-colors"," ").concat({primary:"bg-primary/20 text-primary hover:bg-primary/30",ghost:"bg-neutral-800 text-fg hover:bg-neutral-700",danger:"bg-red-900/40 text-red-300 hover:bg-red-900/60"}[t]," ").concat(r),...l})}r(2265)}},function(e){e.O(0,[800,378,971,23,744],function(){return e(e.s=9859)}),_N_E=e.O()}]);